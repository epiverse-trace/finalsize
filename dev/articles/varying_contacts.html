<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modelling heterogeneous social contacts • finalsize</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modelling heterogeneous social contacts">
<meta name="robots" content="noindex">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">finalsize</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/finalsize.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Package vignettes</h6></li>
    <li><a class="dropdown-item" href="../articles/varying_contacts.html">Modelling heterogeneous social contacts</a></li>
    <li><a class="dropdown-item" href="../articles/varying_susceptibility.html">Modelling heterogeneous susceptibility</a></li>
    <li><a class="dropdown-item" href="../articles/uncertainty_params.html">Modelling uncertainty in R₀</a></li>
    <li><a class="dropdown-item" href="../articles/demographic_turnover.html">Projecting re-emergence risk after waning or new births</a></li>
    <li><a class="dropdown-item" href="../articles/r_eff_reckoner.html">Ready reckoner for R&lt;sub&gt;eff&lt;/sub&gt;</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling guides and background</h6></li>
    <li><a class="dropdown-item" href="../articles/theoretical_background.html">Theoretical background</a></li>
    <li><a class="dropdown-item" href="../articles/compare_sir_model.html">Comparison with a compartmental model</a></li>
    <li><a class="dropdown-item" href="../articles/susceptibility_matrices.html">Guide to constructing susceptibility matrices</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/finalsize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Modelling heterogeneous social contacts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/finalsize/blob/main/vignettes/varying_contacts.Rmd" class="external-link"><code>vignettes/varying_contacts.Rmd</code></a></small>
      <div class="d-none name"><code>varying_contacts.Rmd</code></div>
    </div>

    
    
<p>Populations are often heterogeneous in their social contact patterns. Such heterogeneity is often age-dependent and varies between age groups, and can strongly influence epidemic dynamics if the outbreak primarily circulates in a particular age group. This heterogeneity can be incorporated into final size calculations <span class="citation">(<a href="#ref-miller2012">Miller 2012</a>)</span>, and is implemented in <em>finalsize</em>.</p>
<div class="alert alert-warning">
<p><strong>New to <em>finalsize</em>?</strong> It may help to read the <a href="finalsize.html">“Get started”</a> vignette first!</p>
</div>
<div class="section level2 unnumbered alert alert-primary">
<h2 id="use-case">Use case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>There is substantial <strong>heterogeneity in contact patterns</strong> in a population. We want to know how this heterogeneity could affect the final size of the epidemic.</p>
</div>
<div class="alert alert-secondary">
<div class="section level3 unnumbered">
<h3 id="what-we-have">What we have<a class="anchor" aria-label="anchor" href="#what-we-have"></a>
</h3>
<ol style="list-style-type: decimal">
<li>An estimate of the infection’s basic reproduction number <span class="math inline">\(R_0\)</span>;</li>
<li>An estimate of the distribution of the population in different demographic groups (typically age groups);</li>
<li>An estimate of the contacts between individuals of different demographic groups; and</li>
<li>An estimate of the susceptibility of each demographic group to the infection.</li>
</ol>
</div>
<div class="section level3 unnumbered">
<h3 id="what-we-assume">What we assume<a class="anchor" aria-label="anchor" href="#what-we-assume"></a>
</h3>
<ol style="list-style-type: decimal">
<li>That the infection dynamics can be captured using a Susceptible-Infectious-Recovered (SIR) or Susceptible-Exposed-Infectious-Recovered (SEIR) model, where individuals who have been infected acquire immunity against subsequent infection, at least for the remaining duration of the epidemic.</li>
</ol>
</div>
</div>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load finalsize</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/finalsize" class="external-link">finalsize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details><div class="section level2">
<h2 id="defining-a-value-for-r_0">Defining a value for <span class="math inline">\(R_0\)</span><a class="anchor" aria-label="anchor" href="#defining-a-value-for-r_0"></a>
</h2>
<p>A number of statistical methods can be used to estimate the <span class="math inline">\(R_0\)</span> of an epidemic in its early stages from available data. These are not discussed here, but some examples are given in the <a href="https://epiverse-trace.github.io/episoap/articles/episoap.html" class="external-link"><em>episoap</em> package</a>.</p>
<p>Instead, this example considers a infection with an <span class="math inline">\(R_0\)</span> of 1.5, similar to that which could potentially be observed for pandemic influenza.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define r0 as 1.5</span></span>
<span><span class="va">r0</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span></code></pre></div>
</details><div class="section level3 unnumbered alert alert-secondary">
<h3 id="heterogeneous-social-mixing">Heterogeneous social mixing<a class="anchor" aria-label="anchor" href="#heterogeneous-social-mixing"></a>
</h3>
<p>The social contact data used in this example illustrate an important way in which populations may be heterogeneous: the various age groups can have substantially different patterns of social contacts, and hence different probabilities of acquiring and transmitting infection during an epidemic.</p>
<p>The method implemented in <em>finalsize</em> accounts for this heterogeneity. Other forms of population heterogeneity are covered in the <a href="varying_susceptibility.html">“Heterogeneous susceptibility”</a> vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-and-preparing-contact-and-demography-data">Getting and preparing contact and demography data<a class="anchor" aria-label="anchor" href="#getting-and-preparing-contact-and-demography-data"></a>
</h2>
<p>This example uses social contact data from the POLYMOD project <span class="citation">(<a href="#ref-mossong2008">Mossong et al. 2008</a>)</span> to estimate the final size of an epidemic in the U.K. These data are provided with the <code>socialmixr</code> package.</p>
<p>The contact data are divided into five age groups: 0 – 4, 5 – 17, 18 – 39, 40 – 64, and 65 and over, specified using the <code>age.limits</code> argument in <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code>.
The <code>symmetric = TRUE</code> argument to <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code> returns a symmetric contact matrix, so that the contacts reported by group <span class="math inline">\(\{i\}\)</span> of individuals from group <span class="math inline">\(\{j\}\)</span> are the same as those reported by group <span class="math inline">\(\{j\}\)</span> of group <span class="math inline">\(\{i\}\)</span>.</p>
<p>The demographic data — the number of individuals in each age group — is also available through <code><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">socialmixr::contact_matrix()</a></code>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get UK polymod data</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va"><a href="https://epiforecasts.io/socialmixr/reference/polymod.html" class="external-link">polymod</a></span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">18</span>, <span class="fl">40</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the elements of the contact data list</span></span>
<span><span class="co"># the contact matrix</span></span>
<span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group     [0,5)   [5,18)  [18,40)  [40,65)       65+</span></span>
<span><span class="co">#&gt;   [0,5)   1.9157895 1.467205 3.278803 1.559611 0.3658614</span></span>
<span><span class="co">#&gt;   [5,18)  0.5191021 8.858736 3.421566 2.616146 0.6260247</span></span>
<span><span class="co">#&gt;   [18,40) 0.6252718 1.844236 5.440972 3.492124 0.8092367</span></span>
<span><span class="co">#&gt;   [40,65) 0.2792593 1.324010 3.278895 4.178218 1.2380907</span></span>
<span><span class="co">#&gt;   65+     0.1306272 0.631752 1.515092 2.468756 1.7142857</span></span>
<span></span>
<span><span class="co"># the demography data</span></span>
<span><span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,5)    3453670 0.05728738  2005</span></span>
<span><span class="co">#&gt; 2:    [5,18)    9761554 0.16191873  2005</span></span>
<span><span class="co">#&gt; 3:   [18,40)   18110368 0.30040378  2005</span></span>
<span><span class="co">#&gt; 4:   [40,65)   19288101 0.31993930  2005</span></span>
<span><span class="co">#&gt; 5:       65+    9673058 0.16045081  2005</span></span>
<span></span>
<span><span class="co"># get the contact matrix and demography data</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="va">demography_data</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span></span>
<span></span>
<span><span class="co"># scale the contact matrix so the largest eigenvalue is 1.0</span></span>
<span><span class="co"># this is to ensure that the overall epidemic dynamics correctly reflect</span></span>
<span><span class="co"># the assumed value of R0</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># divide each row of the contact matrix by the corresponding demography</span></span>
<span><span class="co"># this reflects the assumption that each individual in group {j} make contacts</span></span>
<span><span class="co"># at random with individuals in group {i}</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="va">contact_matrix</span> <span class="op">/</span> <span class="va">demography_vector</span></span>
<span></span>
<span><span class="va">n_demo_grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="population-susceptibility">Population susceptibility<a class="anchor" aria-label="anchor" href="#population-susceptibility"></a>
</h2>
<p>As a starting scenario, consider a novel pathogen where all age groups have a similar, high susceptibility to infection. This means it is assumed that all individuals fall into a single category: fully susceptible.</p>
<p>Full uniform susceptibility can be modelled as a matrix with values of 1.0, with as many rows as there are demographic groups. The matrix has a single column, representing the single susceptibility group to which all individuals belong.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># all individuals are equally and highly susceptible</span></span>
<span><span class="va">n_susc_groups</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span>
<span><span class="va">susc_guess</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span></code></pre></div>
</details><details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">susc_guess</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_demo_grps</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_susc_groups</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>Final size calculations also need to know the proportion of each demographic group <span class="math inline">\(\{i\}\)</span> that falls into the susceptibility group <span class="math inline">\(\{j\}\)</span>. This distribution of age groups into susceptibility groups can be represented by the demography-susceptibility distribution matrix.</p>
<p>Since all individuals in each age group have the same susceptibility, there is no variation within age groups. Consequently, all individuals in each age group are assumed to be fully susceptible. This can be represented as a single-column matrix, with as many rows as age groups, and as many columns as susceptibility groups.</p>
<p>In this example, the matrix <code>p_susc_uniform</code> has 5 rows, one for each age group, and only one column, for the single high susceptibility group that holds all individuals.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_susc_uniform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_demo_grps</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_susc_groups</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="section level4 unnumbered alert alert-secondary">
<h4 id="why-susceptibility-and-p_susceptibility-are-matrices">Why susceptibility and p_susceptibility are matrices<a class="anchor" aria-label="anchor" href="#why-susceptibility-and-p_susceptibility-are-matrices"></a>
</h4>
<p>This example models susceptibility (<code>susc_uniform</code>) and the demography-in-susceptibility (<code>p_susc_uniform</code>) as matrices rather than vectors. This is because a single susceptibility group is a special case of the general final size equation.</p>
<p><em>finalsize</em> supports multiple susceptibility groups (this will be covered later), and these are more easily represented as a matrix, the <em>susceptibility matrix</em>.</p>
<p>Each element <span class="math inline">\(\{i, j\}\)</span> in this matrix represents the susceptibility of individuals in demographic group <span class="math inline">\(\{i\}\)</span>, and susceptibility group <span class="math inline">\(\{j\}\)</span>.</p>
<p>In this example, all individuals are equally susceptible to infection, and thus the susceptibility matrix (<code>susc_uniform</code>) has only a single column with identical values.</p>
<p>Consequently, the demography-susceptibility distribution matrix (<code>p_susc_uniform</code>) has the same dimensions, and all of its values are 1.0.</p>
<p>See the <a href="varying_susceptibility.html">“Heterogeneous susceptibility”</a> example for more on cases where susceptibility varies within age groups.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-final_size">Running <code>final_size</code><a class="anchor" aria-label="anchor" href="#running-final_size"></a>
</h2>
<p>The final size of the epidemic in the population can then be calculated using the only function in the package, <code><a href="../reference/final_size.html">final_size()</a></code>. This example allows the function to fall back on the default options for the arguments <code>solver</code> (<code>"iterative"</code>) and <code>control</code> (an empty list).</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate final size</span></span>
<span><span class="va">final_size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/final_size.html">final_size</a></span><span class="op">(</span></span>
<span>  r0 <span class="op">=</span> <span class="va">r0</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  susceptibility <span class="op">=</span> <span class="va">susc_uniform</span>,</span>
<span>  p_susceptibility <span class="op">=</span> <span class="va">p_susc_uniform</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view the output data frame</span></span>
<span><span class="va">final_size_data</span></span>
<span><span class="co">#&gt;   demo_grp   susc_grp susceptibility group_size p_infected n_infected</span></span>
<span><span class="co">#&gt; 1    [0,5) susc_grp_1              1    3453670  0.4160682    1436962</span></span>
<span><span class="co">#&gt; 2   [5,18) susc_grp_1              1    9761554  0.6888703    6724444</span></span>
<span><span class="co">#&gt; 3  [18,40) susc_grp_1              1   18110368  0.5379381    9742257</span></span>
<span><span class="co">#&gt; 4  [40,65) susc_grp_1              1   19288101  0.4639496    8948706</span></span>
<span><span class="co">#&gt; 5      65+ susc_grp_1              1    9673058  0.3042623    2943147</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="visualise-final-sizes">Visualise final sizes<a class="anchor" aria-label="anchor" href="#visualise-final-sizes"></a>
</h3>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order demographic groups as factors</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">demography_data</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="va">demo_grp</span>, <span class="va">p_infected</span></span>
<span>    <span class="op">)</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"% Infected"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="varying_contacts_files/figure-html/unnamed-chunk-10-1.png" alt="Final size of an SIR epidemic in each age group. The final size is the cumulative number of infections in each age group over the course of the epidemic, expressed as a proportion of the respective age group."><p class="caption">
Figure 1: Final size of an SIR epidemic in each age group. The final size is the cumulative number of infections in each age group over the course of the epidemic, expressed as a proportion of the respective age group.
</p>
</div>
</div>
<div class="section level3">
<h3 id="final-size-proportions-to-counts">Final size proportions to counts<a class="anchor" aria-label="anchor" href="#final-size-proportions-to-counts"></a>
</h3>
<p><code>finalsize</code> returns the <em>proportion</em> of each age (and susceptibility) group infected in an epidemic outbreak. The final <em>counts</em> of individuals infected can be visualised as well, by multiplying the final proportion of each age group infected with the total number of individuals in that group.</p>
<p>The example below show how this can be done.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare demography data</span></span>
<span><span class="va">demography_data</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span></span>
<span></span>
<span><span class="co"># merge final size counts with demography vector</span></span>
<span><span class="va">final_size_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span>,</span>
<span>  <span class="va">demography_data</span>,</span>
<span>  by.x <span class="op">=</span> <span class="st">"demo_grp"</span>,</span>
<span>  by.y <span class="op">=</span> <span class="st">"age.group"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reset age group order</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">demo_grp</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">age.group</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># multiply counts with proportion infected</span></span>
<span><span class="va">final_size_data</span><span class="op">$</span><span class="va">n_infected</span> <span class="op">&lt;-</span> <span class="va">final_size_data</span><span class="op">$</span><span class="va">p_infected</span> <span class="op">*</span></span>
<span>  <span class="va">final_size_data</span><span class="op">$</span><span class="va">population</span></span></code></pre></div>
</details><details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">demo_grp</span>, y <span class="op">=</span> <span class="va">n_infected</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"grey"</span>, col <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">final_size_data</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma_format</a></span><span class="op">(</span></span>
<span>      scale <span class="op">=</span> <span class="fl">1e-6</span>, suffix <span class="op">=</span> <span class="st">"M"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15e6</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span></span>
<span>    expand <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Age group"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number infected (millions)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="varying_contacts_files/figure-html/unnamed-chunk-12-1.png" alt="Final size of an epidemic outbreak in a population, for different values of infection $R_0$. Converting the final size proportions in each age group to counts shows that individuals aged 18 -- 64 make up the bulk of cases in this scenario. This may be attributed to this being both the largest age range in the analysis (more years in this range than any other), and because more people fall into this wide range than others. Contrast this figure with the one above, in which similar _proportions_ of each age group are infected."><p class="caption">
Figure 2: Final size of an epidemic outbreak in a population, for different values of infection <span class="math inline">\(R_0\)</span>. Converting the final size proportions in each age group to counts shows that individuals aged 18 – 64 make up the bulk of cases in this scenario. This may be attributed to this being both the largest age range in the analysis (more years in this range than any other), and because more people fall into this wide range than others. Contrast this figure with the one above, in which similar <em>proportions</em> of each age group are infected.
</p>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-miller2012" class="csl-entry">
Miller, Joel C. 2012. <span>“A Note on the Derivation of Epidemic Final Sizes.”</span> <em>Bulletin of Mathematical Biology</em> 74 (9): 2125–41. <a href="https://doi.org/10.1007/s11538-012-9749-6" class="external-link">https://doi.org/10.1007/s11538-012-9749-6</a>.
</div>
<div id="ref-mossong2008" class="csl-entry">
Mossong, Joël, Niel Hens, Mark Jit, Philippe Beutels, Kari Auranen, Rafael Mikolajczyk, Marco Massari, et al. 2008. <span>“Social Contacts and Mixing Patterns Relevant to the Spread of Infectious Diseases.”</span> <em>PLOS Medicine</em> 5 (3): e74. <a href="https://doi.org/10.1371/journal.pmed.0050074" class="external-link">https://doi.org/10.1371/journal.pmed.0050074</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pratik Gupte, Edwin Van Leeuwen, Adam Kucharski, Rosalind Eggo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

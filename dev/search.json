[{"path":"https://epiverse-trace.github.io/finalsize/dev/CONTRIBUTING.html","id":null,"dir":"","previous_headings":"","what":"Contributing to finalsize","title":"Contributing to finalsize","text":"outlines propose change finalsize.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/CONTRIBUTING.html","id":"making-changes","dir":"","previous_headings":"","what":"Making changes","title":"Contributing to finalsize","text":"want make change, ’s good idea first file issue make sure someone team agrees ’s needed. ’ve found bug, please file issue illustrates bug minimal reprex (also help write unit test, needed). See bug report template. feature request see feature request.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/CONTRIBUTING.html","id":"pull-request-process","dir":"","previous_headings":"Making changes","what":"Pull request process","title":"Contributing to finalsize","text":"See pull request template Fork package clone onto computer. haven’t done , recommend using usethis::create_from_github(\"epiverse-trace/finalsize\", fork = TRUE). Install development dependencies devtools::install_dev_deps(), make sure package passes R CMD check running devtools::check(). R CMD check doesn’t pass cleanly, ’s good idea ask help continuing. Create Git branch pull request (PR). recommend using usethis::pr_init(\"brief-description--change\"). Make changes, commit git, create PR running usethis::pr_push(), following prompts browser. title PR briefly describe change. body PR contain Fixes #issue-number. user-facing changes, add bullet top NEWS.md (.e. just first header). Follow style described https://style.tidyverse.org/news.html.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/CONTRIBUTING.html","id":"code-style","dir":"","previous_headings":"Making changes","what":"Code style","title":"Contributing to finalsize","text":"New code follow tidyverse style guide. can use styler package apply styles, please don’t restyle code nothing PR. use roxygen2, Markdown syntax, documentation. use testthat unit tests. Contributions test cases included easier accept.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/CONTRIBUTING.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of Conduct","title":"Contributing to finalsize","text":"Please note finalsize project released Contributor Code Conduct. contributing project agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 finalsize authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"sir-model-definition","dir":"Articles","previous_headings":"","what":"SIR model definition","title":"Comparison with a compartmental model","text":"First, define simple SIR model helper function replicate contact matrix rows columns. , model defined iteration transitions epidemiological compartments. transitions form system ordinary differential equations (ODEs), whose solution time also obtained using solver deSolve::lsoda(). Interested compartmental modelling obtain timeseries epidemic outcomes? epidemics package might useful! Prepare \\(R_0\\).","code":"# Replicate the contact matrix repmat <- function(X, m, n) {   mx <- dim(X)[1]   nx <- dim(X)[2]   matrix(t(matrix(X, mx, nx * n)), mx * m, nx * n, byrow = TRUE) }  # Calculate the proportion of individuals infected final_size_r <- function(r0, contact_matrix,                          demography_vector, susceptibility, p_susceptibility) {   # check p_susceptibility   stopifnot(all(rowSums(p_susceptibility) == 1))    p_susc <- as.vector(p_susceptibility)   susc <- as.vector(susceptibility)   demo_v <- rep(demography_vector, ncol(p_susceptibility)) * p_susc   nsteps <- 10000    # epidemiological parameters   h <- 0.1   beta <- r0   gamma <- 1    # initial conditions   I <- 1e-8 * demo_v   S <- demo_v - I   R <- 0    # prepare contact matrix   m <- repmat(contact_matrix, ncol(p_susceptibility), ncol(p_susceptibility))    # multiply contact matrix by susceptibility   m <- m * susc    # iterate over compartmental transitions   for (i in seq_len(nsteps)) {     force <- (m %*% I) * S * h * beta     S <- S - force     g <- I * gamma * h     I <- I + force - g     R <- R + g   }    # return proportion of individuals recovered   as.vector(R / demo_v) } r0 <- 2.0"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"final-size-in-a-uniformly-mixing-population","dir":"Articles","previous_headings":"","what":"Final size in a uniformly mixing population","title":"Comparison with a compartmental model","text":", assumption uniformly mixing population social contacts differ among demographic groups (, age groups). small discrepancy final epidemics sizes returned final_size() SIR model. One quick check identify source error calculate difference two sides finalsize equation, .e. \\(x\\), estimated final size, \\(1 - e^{-R_0x}\\) (difference \\(x - (1 - e^{-R_0x})\\)) see final size estimates incorrect — small error, error tolerance value (\\(1^{-6}\\)), indicate method checked less correct, larger error suggest method correct. can written temporary function. suggests SIR model makes small error final size estimate, finalsize::final_size() provides estimate within specified solver tolerance (\\(1^{-6}\\)).","code":"# estimated population size for the UK is 67 million population_size <- 67e6  # estimate using finalsize::final_size final_size_finalsize <- final_size(   r0 = r0,   contact_matrix = matrix(1) / population_size,   demography_vector = population_size,   susceptibility = matrix(1),   p_susceptibility = matrix(1),   solver = \"newton\" )  # estimate from SIR model final_size_sir <- final_size_r(   r0 = r0,   contact_matrix = 0.99 * matrix(1) / population_size,   demography_vector = population_size,   susceptibility = matrix(1),   p_susceptibility = matrix(1) )  # View the estimates final_size_finalsize #>     demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1 demo_grp_1 susc_grp_1              1    6.7e+07  0.7968121   53386413  final_size_sir #> [1] 0.7968781 # function to check error in final size estimates final_size_error <- function(x, r0, tolerance = 1e-6) {   error <- abs(x - (1.0 - exp(-r0 * x)))   if (any(error > tolerance)) {     print(\"Final size estimate error is greater than tolerance!\")   }   # return error   error } # error for estimate using finalsize::final_size() final_size_error(final_size_finalsize$p_infected, r0) #> [1] 0  # error for estimate from SIR model final_size_error(final_size_sir, r0) #> [1] \"Final size estimate error is greater than tolerance!\" #> [1] 3.915923e-05"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"final-size-with-heterogeneous-mixing","dir":"Articles","previous_headings":"","what":"Final size with heterogeneous mixing","title":"Comparison with a compartmental model","text":", comparison considers scenarios social contacts vary demographic groups, , age groups. See vignette “Modelling heterogeneous social contacts” guidance implement scenarios.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"prepare-population-data","dir":"Articles","previous_headings":"Final size with heterogeneous mixing","what":"Prepare population data","title":"Comparison with a compartmental model","text":"First, prepare population data using dataset provided finalsize. includes preparing population’s age-specific contact matrix demography distribution vector, well susceptibility demography--susceptibility distribution vectors. See “Guide constructing susceptibility matrices” help understanding latter step, see vignette “Modelling heterogeneous susceptibility” worked examples. Examine contact matrix demography vector.","code":"# Load example POLYMOD data included with the package data(polymod_uk)  # Define contact matrix (entry {ij} is contacts in group i # reported by group j) contact_matrix <- polymod_uk$contact_matrix  # Define population in each age group demography_vector <- polymod_uk$demography_vector contact_matrix #>                   #> contact.age.group         [,1]         [,2]         [,3] #>           [0,20)  4.514575e-08 1.600071e-08 8.965770e-09 #>           [20,40) 1.600071e-08 2.489595e-08 1.346051e-08 #>           40+     8.965770e-09 1.346051e-08 1.464763e-08  demography_vector #> [1] 14799290 16526302 28961159"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"susceptibility-varies-between-groups","dir":"Articles","previous_headings":"Final size with heterogeneous mixing","what":"Susceptibility varies between groups","title":"Comparison with a compartmental model","text":"scenario, susceptibility infection varies groups, older age groups (20 ) half susceptible individuals aged (0 – 19). Examine final size estimates. final size estimates close, difference fundamentally alter understanding potential outcomes epidemic population.","code":"# Define susceptibility of each group susceptibility <- matrix(   data = c(1.0, 0.5, 0.5),   nrow = length(demography_vector),   ncol = 1 )  # Assume uniform susceptibility within age groups p_susceptibility <- matrix(   data = 1.0,   nrow = length(demography_vector),   ncol = 1 ) # from {finalsize} using finalsize::final_size final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility,   solver = \"newton\" ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1            1.0   14799290  0.7119330   10536103 #> 2  [20,40) susc_grp_1            0.5   16526302  0.3252457    5375109 #> 3      40+ susc_grp_1            0.5   28961159  0.2334420    6760752  # using SIR model final_size_r(   r0 = r0,   contact_matrix = contact_matrix * 0.99,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #> [1] 0.7057450 0.3187776 0.2281473"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"susceptibility-varies-within-groups-in-different-proportions","dir":"Articles","previous_headings":"Final size with heterogeneous mixing","what":"Susceptibility varies within groups in different proportions","title":"Comparison with a compartmental model","text":"scenario, susceptibility infection varies within age groups, fraction age group much less susceptible. Additionally, proportion individuals low susceptibility varies groups, individuals aged (0 – 19) much likely low susceptibility older age groups. Examine final size estimates scenario. , final size estimates similar, provide essentially understanding potential outcomes epidemic population.","code":"# Define susceptibility of each group # Here susceptibility <- matrix(   c(1.0, 0.1),   nrow = length(demography_vector), ncol = 2,   byrow = TRUE )  # view the susceptibility matrix susceptibility #>      [,1] [,2] #> [1,]    1  0.1 #> [2,]    1  0.1 #> [3,]    1  0.1  # Assume variation in susceptibility within age groups # A higher proportion of 0 -- 20s are in the lower susceptibility group p_susceptibility <- matrix(1, nrow = length(demography_vector), ncol = 2) p_susceptibility[, 2] <- c(0.6, 0.5, 0.3) p_susceptibility[, 1] <- 1 - p_susceptibility[, 2]  # view p_susceptibility p_susceptibility #>      [,1] [,2] #> [1,]  0.4  0.6 #> [2,]  0.5  0.5 #> [3,]  0.7  0.3 # estimate group-specific final sizes using finalsize::final_size final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1            1.0    5919716 0.27211694  1610855.0 #> 2  [20,40) susc_grp_1            1.0    8263151 0.24819087  2050838.6 #> 3      40+ susc_grp_1            1.0   20272811 0.19449495  3942959.4 #> 4   [0,20) susc_grp_2            0.1    8879574 0.03126239   277596.7 #> 5  [20,40) susc_grp_2            0.1    8263151 0.02812422   232394.7 #> 6      40+ susc_grp_2            0.1    8688348 0.02139636   185899.0  # estimate group-specific final sizes from the SIR model final_size_r(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #> [1] 0.27261723 0.24864863 0.19485488 0.03132008 0.02817620 0.02143593"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/compare_sir_model.html","id":"complete-immunity-to-infection-in-part-of-the-population","dir":"Articles","previous_headings":"Final size with heterogeneous mixing","what":"Complete immunity to infection in part of the population","title":"Comparison with a compartmental model","text":"scenario, fraction age group completely immune infection. Additionally, individuals aged (0 – 19) much likely complete immunity older age groups. , method finalsize::final_size() correctly provides estimates 0.0 susceptibility group (age group) completely immune, SIR model method estimates small fraction completely immune groups still infected. discrepancy due assumption initial conditions SIR model, wherein fraction (\\(1^{-8}\\)) assumed initially infected.","code":"# Define susceptibility of each group susceptibility <- matrix(1, nrow = length(demography_vector), ncol = 2) susceptibility[, 2] <- 0.0  # view susceptibility susceptibility #>      [,1] [,2] #> [1,]    1    0 #> [2,]    1    0 #> [3,]    1    0  # Assume that some proportion are completely immune # complete immunity is more common among younger individuals p_susceptibility <- matrix(1, nrow = length(demography_vector), ncol = 2) p_susceptibility[, 2] <- c(0.6, 0.5, 0.3) p_susceptibility[, 1] <- 1 - p_susceptibility[, 2]  # view p_susceptibility p_susceptibility #>      [,1] [,2] #> [1,]  0.4  0.6 #> [2,]  0.5  0.5 #> [3,]  0.7  0.3 final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1              1    5919716 0.07787362   460989.7 #> 2  [20,40) susc_grp_1              1    8263151 0.07227733   597238.5 #> 3      40+ susc_grp_1              1   20272811 0.05594389  1134140.0 #> 4   [0,20) susc_grp_2              0    8879574 0.00000000        0.0 #> 5  [20,40) susc_grp_2              0    8263151 0.00000000        0.0 #> 6      40+ susc_grp_2              0    8688348 0.00000000        0.0  final_size_r(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #> [1] 0.07791032 0.07231121 0.05597004 0.00000001 0.00000001 0.00000001"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Projecting re-emergence risk after waning or new births","text":"want know long might take (partially) immunising infection re-emerge following initial large epidemic. question common emerging vector-borne infections like Zika Chikungunya (Kucharski et al. 2016).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Projecting re-emergence risk after waning or new births","text":"addition \\(R_0\\), data waning immunity population birth rates. measure error estimated \\(R_0\\) infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Projecting re-emergence risk after waning or new births","text":"SIR epidemic, assuming everyone fully susceptible initially mixing random. simplifying assumption previously used modelling emerging vector-borne infections like Zika (Andronico et al. 2017). Gradual waning immunity, certain proportion immune individuals becoming susceptible year. Note: can set proportion equal zero -waning scenario. Gradual influx new susceptibles via annual birth rate (equal death rate population size remains constant).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"modelling-the-initial-epidemic","dir":"Articles","previous_headings":"","what":"Modelling the initial epidemic","title":"Projecting re-emergence risk after waning or new births","text":"follow approach described “Modelling uncertainty R₀” vignette, includes uncertainty final size calculations running final_size() values drawn distribution, summarising outcomes. simplicity, use model assumes uniformly mixing population. similar approach used multiple age groups, although require assumptions waning age specific susceptibility population turnover ensure consistent demographic patterns. First define future window time considering, well rate waning (assumed 5% per year) influx new susceptibles (assuming 14 births per 1,000 per year). also define distribution \\(R_0\\) values initial epidemic second later re-emerging outbreak, following normal distribution \\(N(\\mu = 2, \\sigma = 0.3)\\). Next simulate initial epidemics using final_size(), iterating \\(R_0\\) values sampled .","code":"# future time period considered years_range <- seq(0, 20)  # proportion losing immunity per year annual_wane <- 0.05  # proportion newly susceptible per year birth_rate <- 14 / 1000  # define r0 values r0_mean <- 2.0 r0_samples <- rnorm(n = 100, mean = r0_mean, sd = 0.3) # for first outbreak r0_samples2 <- rnorm(n = 100, mean = r0_mean, sd = 0.3) # for second outbreak # run final size for each value and collate estimates # use `Map()` to iterate over values and an index to add to the final data final_size_est <- Map(   function(r0, i) {     fs <- final_size(r0)$p_infected # run final size model, get estimate only     data.frame(fs = fs, i = i, r0 = r0) # data.frame for each value considered   },   r0 = r0_samples,   i = seq_along(r0_samples) )  # use Reduce to combine the list of data.frames into a single data.frame final_size_df <- Reduce(rbind, final_size_est)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"modelling-waning-immunity-and-influx-of-susceptibles","dir":"Articles","previous_headings":"","what":"Modelling waning immunity and influx of susceptibles","title":"Projecting re-emergence risk after waning or new births","text":"calculate relative population immunity, accounting waning immunity initial epidemic, accounting influx (due new births) new susceptibles range 20 years. calculated \\(I_y = (1 - \\text{annual waning})^y \\times (1 - b y)\\), \\(b\\) birth rate; vectorised range years code.","code":"# define changes in susceptibility over time from waning # and population turnover (assuming) rectangular age distribution relative_immunity <- (1 - annual_wane)^(years_range) *   pmax(1 - birth_rate * years_range, 0) # use pmax in case of longer year range"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/demographic_turnover.html","id":"projected-estimates-of-effective-r","dir":"Articles","previous_headings":"","what":"Projected estimates of effective \\(R\\)","title":"Projecting re-emergence risk after waning or new births","text":"simulated distribution initial epidemic sizes based distribution \\(R_0\\), next implement waning influx new susceptibles calculate level immunity coming years, relative level immunity end epidemic. step-wise process: initial final size calculations given us estimates population’s ‘relative immunity’ year 0 (.e., final size; assuming recovered individuals immune); allows us calculate relative susceptibility relative immunity, \\(\\text{susceptibility} = 1 - I_y\\); can calculated year \\(y\\) using predicted immunity year \\(I_y\\); effective reproduction number (.e. \\(R\\) partially susceptible population) can calculated \\(R = R_0 \\times \\text{susceptibility}\\) year; can predict \\(R\\) coming years population susceptibility increases. \\(R\\) rises critical value 1, potential sustained transmission population hence another large epidemic. calculate level susceptibility - hence \\(R\\) - distribution \\(R_0\\) values assumed re-emerging epidemic. example, distribution original epidemic (plausible pathogen setting), alter assumption think factors like population density climate change might change transmissibility infection future. scenario, majority new susceptibility comes waning, rather influx new births (.e. 5% vs 1.4% per year). result, predicted value \\(R\\) rises substantially years following initial epidemic, suggesting potential re-emergence within 5-10 years. Figure 1: Predicted value effective reproduction number \\(R\\) following initial epidemic emerging infection year 0. assume 5% immune population becomes susceptible year following epidemic, influx new susceptibles via birth rate 14/1000 per year. also assume \\(R_0\\) mean 2, standard deviation around estimate 0.3.","code":"# calculate effective R for each value and collate estimates r_eff_est <- Map(   function(r0, fs) {     r_eff <- (1 - fs * relative_immunity) * r0      # data.frame for each value considered     data.frame(r_eff = r_eff, yr = years_range)   },   r0 = r0_samples2,   fs = final_size_df$fs )  # use Reduce to combine the list of data.frames into a single data.frame r_eff_df <- Reduce(rbind, r_eff_est) # plot results ggplot(r_eff_df) +   geom_hline(yintercept = 1, linetype = \"dashed\", color = \"gray\") +   geom_vline(xintercept = 0, colour = \"red\", linetype = \"dashed\") +   annotate(     geom = \"text\",     x = 0, y = 2, angle = 90, vjust = \"outward\",     colour = \"red\",     label = \"Initial epidemic at year 0\"   ) +   stat_summary(     aes(       yr, r_eff     ),     fun = mean,     fun.min = function(x) {       quantile(x, 0.025)     },     fun.max = function(x) {       quantile(x, 0.975)     }   ) +   scale_y_continuous(     limits = c(0, 3)   ) +   theme_classic() +   coord_cartesian(     expand = TRUE   ) +   labs(     x = \"Years after initial epidemic\",     y = \"Effective R (mean and 95% CI)\"   )"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Calculating the final size of an epidemic","text":"epidemic underway. want know many individuals expect infected total given level transmission population susceptibility: cumulative sum infections, final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Calculating the final size of an epidemic","text":"estimate infection’s basic reproduction number \\(R_0\\); estimate population size; estimate susceptibility population infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Calculating the final size of an epidemic","text":"infection dynamics can captured using Susceptible-Infectious-Recovered (SIR) Susceptible-Exposed-Infectious-Recovered (SEIR) model, individuals infected acquire immunity subsequent infection, least remaining duration epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"defining-a-value-for-r_0","dir":"Articles","previous_headings":"","what":"Defining a value for \\(R_0\\)","title":"Calculating the final size of an epidemic","text":"number statistical methods can used estimate \\(R_0\\) epidemic early stages available data. discussed , examples given episoap package. Instead, example considers infection \\(R_0\\) 1.5, similar potentially observed pandemic influenza.","code":"# define r0 as 1.5 r0 <- 1.5"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"getting-population-estimates","dir":"Articles","previous_headings":"","what":"Getting population estimates","title":"Calculating the final size of an epidemic","text":"Population estimates country scale relatively easy get trusted data aggregators World Data. detailed breakdowns population estimates sub-national scale may available respective national governments. , use estimate U.K. population size 67 million. initial example assumes uniform mixing, .e., individuals population similar number social contacts. can modelled form single-element contact matrix, must divided population size. Social contacts well known non-uniform, age strong influence many contacts person , moreover, ages contacts. relatively simple example children school-going age, typically social contacts elderly, whose social contacts schoolchildren. “Modelling heterogeneous contacts” vignette explores can incorporated final epidemic size calculations using finalsize.","code":"# get UK population size uk_pop <- 67 * 1e6 # prepare contact matrix contact_matrix <- matrix(1.0) / uk_pop"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"modelling-population-susceptibility","dir":"Articles","previous_headings":"","what":"Modelling population susceptibility","title":"Calculating the final size of an epidemic","text":"initial example, population assumed fully susceptible infection. modelled form matrix single element, called susceptibility. Since individuals fully susceptible, break-population susceptibility groups can represented another single-element matrix, called p_susceptibility. Susceptibility infection well known vary due number factors, including age, prior exposure pathogen, immunisation due vaccination campaign. “Modelling heterogeneous susceptibility” vignette explores variation susceptibility within demographic groups can incorporated final epidemic size calculations using finalsize.","code":"# all individuals are fully susceptible susceptibility <- matrix(1.0) # all individuals are in the single, high-susceptibility group p_susceptibility <- matrix(1.0)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"running-final_size","dir":"Articles","previous_headings":"","what":"Running final_size","title":"Calculating the final size of an epidemic","text":"final size epidemic population can calculated using function package, final_size(). example allows function fall back default options arguments solver (\"iterative\") control (empty list). final epidemic size – proportional well absolute terms – without accounting heterogeneity social contacts age factors, without accounting variation susceptibility infection within demographic groups. value, 58% population 39 million people, expected proportion number individuals infected course epidemic.","code":"# calculate final size final_size_data <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = uk_pop,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility )  # view the output data frame final_size_data #>     demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1 demo_grp_1 susc_grp_1              1    6.7e+07  0.5828132   39048485"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/finalsize.html","id":"a-short-cut-for-homogeneous-populations","dir":"Articles","previous_headings":"","what":"A short-cut for homogeneous populations","title":"Calculating the final size of an epidemic","text":"example explains steps go final size calculation. one specific use-case, wherein population assumed homogeneous mixing (.e., groups differ social contacts), homogeneous full susceptibility infection, final size calculation depends \\(R_0\\) epidemic. case, final size calculation can simplified final_size(r0), parameters taking default values, assume homogeneous social contacts susceptibility.","code":"final_size(r0) #>     demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1 demo_grp_1 susc_grp_1              1          1  0.5828132  0.5828132"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Guide to constructing susceptibility matrices","text":"need create two matrices, susceptibility p_susceptibility, pass two arguments final_size() function. five case examples different scenarios content matrix.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Guide to constructing susceptibility matrices","text":"scenario individuals equally susceptible infection; , scenario older individuals susceptible infection younger individuals; , scenario susceptibility increases age, older individuals benefit immunization.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Guide to constructing susceptibility matrices","text":"Complete partitioning individuals different demographic susceptibility groups, .e., individuals population fall one demographic group, one susceptibility group.","code":""},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"susceptibility-matrix","dir":"Articles","previous_headings":"Primer on susceptibility matrices","what":"Susceptibility matrix","title":"Guide to constructing susceptibility matrices","text":"Represents probability infection combination demographic infection-risk groups. \\[ \\; demographic \\; groups \\left.\\vphantom{\\begin{matrix} s_{1,1} & s_{1,2} & \\cdots & s_{1,j} \\\\ s_{2,1} & s_{2,2} & \\cdots & s_{2,j} \\\\ \\vdots  & \\vdots  & \\ddots & \\vdots  \\\\ s_{,1} & s_{,2} & \\cdots & s_{,j} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} s_{1,1} & s_{1,2} & \\cdots & s_{1,j} \\\\ s_{2,1} & s_{2,2} & \\cdots & s_{2,j} \\\\ \\vdots  & \\vdots  & \\ddots & \\vdots  \\\\ s_{,1} & s_{,2} & \\cdots & s_{,j} \\end{matrix}}^{\\displaystyle j \\; susceptibility \\; groups} \\quad s: susceptibility \\] element \\(\\{, j\\}\\) matrix represents susceptibility individuals demographic group \\(\\{\\}\\) (rows), susceptibility group \\(\\{j\\}\\) (columns). common example demographic group population age group, population typically made multiple age groups. Examples infection-risk groups may include individuals different immunization status, different prior exposure pathogens. Final size calculations allow us specify different susceptibility infection demography risk group combination (e.g. fully vaccinated people 65 years old).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"demography-in-susceptibility-matrix","dir":"Articles","previous_headings":"Primer on susceptibility matrices","what":"Demography-in-susceptibility matrix","title":"Guide to constructing susceptibility matrices","text":"Represents proportion (probability) individuals demographic group also specific susceptibility group. \\[ \\; demographic \\; groups \\left.\\vphantom{\\begin{matrix} p_{1,1} & p_{1,2} & \\cdots & p_{1,j} \\\\ p_{2,1} & p_{2,2} & \\cdots & p_{2,j} \\\\ \\vdots  & \\vdots  & \\ddots & \\vdots  \\\\ p_{,1} & p_{,2} & \\cdots & p_{,j} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} p_{1,1} & p_{1,2} & \\cdots & p_{1,j} \\\\ p_{2,1} & p_{2,2} & \\cdots & p_{2,j} \\\\ \\vdots  & \\vdots  & \\ddots & \\vdots  \\\\ p_{,1} & p_{,2} & \\cdots & p_{,j} \\end{matrix}}^{\\displaystyle j \\; susceptibility \\; groups} \\quad p: probability \\] element \\(\\{, j\\}\\) matrix represents proportion demographic group \\(\\{\\}\\) falls susceptibility group \\(\\{j\\}\\). Consequently, rows must always sum 1.0. share five case examples different scenarios influences content structure two matrices.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"homogeneous-susceptibility","dir":"Articles","previous_headings":"","what":"Homogeneous susceptibility","title":"Guide to constructing susceptibility matrices","text":"","code":"library(dplyr) library(tibble)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"case-1-uniform-susceptibility","dir":"Articles","previous_headings":"Homogeneous susceptibility","what":"Case 1: Uniform susceptibility","title":"Guide to constructing susceptibility matrices","text":"scenario assumes individuals age groups population interest 80% susceptibility infection. example, individuals age groups equally susceptible infection; thus, susceptibility matrix (susceptibility) single column identical values. susceptibility matrix (susceptibility) demography--susceptibility matrix (p_susceptibility) must always dimensions. \\[ 4 \\; demo. \\; groups \\left.\\vphantom{\\begin{matrix} s_{1,1} \\\\ s_{2,1} \\\\ s_{3,1} \\\\ s_{4,1} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} s_{1,1} \\\\ s_{2,1} \\\\ s_{3,1} \\\\ s_{4,1} \\end{matrix}}^{\\displaystyle 1 \\; susceptibility \\; group} \\quad 4 \\; demo. \\; groups \\left.\\vphantom{\\begin{matrix} p_{1,1} \\\\ p_{2,1} \\\\ p_{3,1} \\\\ p_{4,1} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} p_{1,1} \\\\ p_{2,1} \\\\ p_{3,1} \\\\ p_{4,1} \\end{matrix}}^{\\displaystyle 1 \\; susceptibility \\; group} \\]","code":"# susceptibility matrix susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(0.8, 0.8, 0.8, 0.8, 0.8) ) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  susceptibility #>         susceptible #> [0,5)           0.8 #> [5,18)          0.8 #> [18,40)         0.8 #> [40,65)         0.8 #> 65+             0.8 # demography-in-susceptibility matrix p_susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(1.0, 1.0, 1.0, 1.0, 1.0) ) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  p_susceptibility #>         susceptible #> [0,5)             1 #> [5,18)            1 #> [18,40)           1 #> [40,65)           1 #> 65+               1"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"case-2-susceptibility-varies-between-groups","dir":"Articles","previous_headings":"Heterogeneous susceptibility","what":"Case 2: Susceptibility varies between groups","title":"Guide to constructing susceptibility matrices","text":"scenario assumes , population, different susceptibility infection individuals different age groups, 20% (infants) 100% (65+).","code":"# susceptibility matrix susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(0.2, 0.5, 0.6, 0.9, 1.0) ) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  susceptibility #>         susceptible #> [0,5)           0.2 #> [5,18)          0.5 #> [18,40)         0.6 #> [40,65)         0.9 #> 65+             1.0  # demography-in-susceptibility matrix p_susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(1.0, 1.0, 1.0, 1.0, 1.0) ) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  p_susceptibility #>         susceptible #> [0,5)             1 #> [5,18)            1 #> [18,40)           1 #> [40,65)           1 #> 65+               1"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"case-3-susceptibility-varies-both-between-and-within-groups","dir":"Articles","previous_headings":"Heterogeneous susceptibility","what":"Case 3: Susceptibility varies both between and within groups","title":"Guide to constructing susceptibility matrices","text":"scenario assumes , population, different susceptibility infection: individuals different age groups 20% (infants) 100% (65+), within individuals age group due immunization effect 25% 40% age groups. Note two susceptibility groups, susceptibility matrix two columns. corresponding demography--susceptibility matrix must also two columns! \\[ 4 \\; demo. \\; groups \\left.\\vphantom{\\begin{matrix} s_{1,1} & s_{1,2} \\\\ s_{2,1} & s_{2,2} \\\\ s_{3,1} & s_{3,2} \\\\ s_{4,1} & s_{4,2} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} s_{1,1} & s_{1,2} \\\\ s_{2,1} & s_{2,2} \\\\ s_{3,1} & s_{3,2} \\\\ s_{4,1} & s_{4,2} \\end{matrix}}^{\\displaystyle 2 \\; suscept. \\; groups} \\quad 4 \\; demo. \\; groups \\left.\\vphantom{\\begin{matrix} p_{1,1} & p_{1,2} \\\\ p_{2,1} & p_{2,2} \\\\ p_{3,1} & p_{3,2} \\\\ p_{4,1} & p_{4,2} \\end{matrix}}\\right\\{ \\overbrace{ \\begin{matrix} p_{1,1} & p_{1,2} \\\\ p_{2,1} & p_{2,2} \\\\ p_{3,1} & p_{3,2} \\\\ p_{4,1} & p_{4,2} \\end{matrix}}^{\\displaystyle 2 \\; suscept. \\; groups} \\]","code":"immunization_effect <- 0.25  # susceptibility matrix susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   unimmunised = c(0.2, 0.5, 0.6, 0.9, 1.0) ) %>%   mutate(immunised = unimmunised * (1 - immunization_effect)) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  susceptibility #>         unimmunised immunised #> [0,5)           0.2     0.150 #> [5,18)          0.5     0.375 #> [18,40)         0.6     0.450 #> [40,65)         0.9     0.675 #> 65+             1.0     0.750  # demography-in-susceptibility matrix p_susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   immunised = c(0.4, 0.4, 0.4, 0.4, 0.4) ) %>%   mutate(unimmunised = 1 - immunised) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  p_susceptibility #>         immunised unimmunised #> [0,5)         0.4         0.6 #> [5,18)        0.4         0.6 #> [18,40)       0.4         0.6 #> [40,65)       0.4         0.6 #> 65+           0.4         0.6"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"case-4-susceptibility-varies-within-groups-in-different-proportion","dir":"Articles","previous_headings":"Heterogeneous susceptibility","what":"Case 4: Susceptibility varies within groups in different proportion","title":"Guide to constructing susceptibility matrices","text":"scenario assumes , population, different susceptibility infection: individuals different age groups 20% (infants) 100% (65+), within individuals age group due immunization effect 25%. immunization uptake rate also different age groups: immunization increases age 20% (infants) 90% (65+)","code":"immunization_effect <- 0.25  # susceptibility matrix susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   unimmunised = c(0.2, 0.5, 0.6, 0.9, 1.0) ) %>%   mutate(immunised = unimmunised * (1 - immunization_effect)) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  susceptibility #>         unimmunised immunised #> [0,5)           0.2     0.150 #> [5,18)          0.5     0.375 #> [18,40)         0.6     0.450 #> [40,65)         0.9     0.675 #> 65+             1.0     0.750  # demography-in-susceptibility matrix p_susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   immunised = c(0.2, 0.4, 0.6, 0.7, 0.9) ) %>%   mutate(unimmunised = 1 - immunised) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  p_susceptibility #>         immunised unimmunised #> [0,5)         0.2         0.8 #> [5,18)        0.4         0.6 #> [18,40)       0.6         0.4 #> [40,65)       0.7         0.3 #> 65+           0.9         0.1"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/susceptibility_matrices.html","id":"case-5-susceptibility-varies-within-three-groups","dir":"Articles","previous_headings":"Heterogeneous susceptibility","what":"Case 5: Susceptibility varies within three groups","title":"Guide to constructing susceptibility matrices","text":"scenario assumes , population, different susceptibility infection: individuals different age groups 20% (infants) 100% (65+), within individuals age group due immunization effect 25% 40% age groups. Additionally, 10% individuals age groups 100% susceptibility, due immunization exposed similar pathogens previously. Recall demography--susceptibility matrix (p_susceptibility) row must always sum 1.0!","code":"immunization_effect <- 0.25  # susceptibility matrix susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(1.0, 1.0, 1.0, 1.0, 1.0),   unimmunised = c(0.2, 0.5, 0.6, 0.9, 1.0) ) %>%   mutate(immunised = unimmunised * (1 - immunization_effect)) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  susceptibility #>         susceptible unimmunised immunised #> [0,5)             1         0.2     0.150 #> [5,18)            1         0.5     0.375 #> [18,40)           1         0.6     0.450 #> [40,65)           1         0.9     0.675 #> 65+               1         1.0     0.750  # demography-in-susceptibility matrix p_susceptibility <- tibble(   age_group = c(\"[0,5)\", \"[5,18)\", \"[18,40)\", \"[40,65)\", \"65+\"),   susceptible = c(0.1, 0.1, 0.1, 0.1, 0.1),   immunised = c(0.4, 0.4, 0.4, 0.4, 0.4) ) %>%   mutate(unimmunised = 1 - immunised - susceptible) %>%   column_to_rownames(var = \"age_group\") %>%   as.matrix()  p_susceptibility #>         susceptible immunised unimmunised #> [0,5)           0.1       0.4         0.5 #> [5,18)          0.1       0.4         0.5 #> [18,40)         0.1       0.4         0.5 #> [40,65)         0.1       0.4         0.5 #> 65+             0.1       0.4         0.5"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/theoretical_background.html","id":"from-sir-to-final-size-with-homogeneous-mixing","dir":"Articles","previous_headings":"","what":"From SIR to final size with homogeneous mixing","title":"Theoretical background","text":"dynamics proportion susceptible infectious individuals time standard susceptible-infectious-recovered (SIR) epidemic model given following ordinary differential equations: \\[ \\frac{d S(t)}{d t} = -\\beta S(t) (t) \\\\ \\frac{d (t)}{d t}  =  \\beta S(t) (t) -\\gamma (t) \\] \\(\\beta\\) transmission rate \\(\\gamma\\) rate recovery. calculate proportion infected, need derive expression proportion susceptibles got infected epidemic, .e. \\(\\phi = 1- S(\\infty)/S(0)\\). Rather simulating model long time period (.e. \\(t \\rightarrow \\infty\\)), can instead calculate \\(dI/dS\\) integrate: \\[ \\frac{d }{d S} = - 1 + \\frac{\\gamma}{\\beta S} \\\\ (t) = - S(t) + \\frac{\\gamma}{\\beta} \\log S(t) + c \\] \\(c\\) depends initial conditions. assumption population fully susceptible initially (.e. \\(S(0)=1\\)), \\((t) \\rightarrow 0\\) \\(t \\rightarrow \\infty\\), obtain following: \\[ \\log S(\\infty) = - R_0 [1-S(\\infty) ] \\\\ \\mathrm{log}~\\phi  -R_0 (1-\\phi) = 0 = F(\\phi) \\] equation doesn’t analytical solution, various methods available allow solved numerically find unique solution (0,1]. example, can use Newton’s method (solver = \"newton\" final_size() function) find final epidemic size: Select arbitrary initial estimate \\(x_0\\) tolerance \\(T\\) ; Solve \\(\\frac{dF}{d \\phi} (x_0) \\Delta x = −F(x_0) ~ \\text{} ~ \\Delta x\\) ; Set \\(x_{+1} = x_i + \\Delta x\\); Repeat \\(x_i\\) converges sufficiently (.e. difference step less \\(T\\))","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/theoretical_background.html","id":"varying-susceptibility","dir":"Articles","previous_headings":"","what":"Varying susceptibility","title":"Theoretical background","text":"can extend formulation account variable susceptibility among individuals, following methods outlined Miller (2012). First, define \\(p(x)\\) probability density randomly chosen individual susceptibility type \\(x\\). define probability individual type \\(x\\) ultimately infected \\(\\phi(x)\\), overall proportion population infected defined follows, depending whether \\(p(x)\\) continuous discrete distribution: \\[ \\hat\\phi = \\int_0^\\infty \\phi(x) p(x) dx \\\\ \\text{} \\\\ \\hat\\phi = \\sum_x \\phi(x) p(x) dx \\\\ \\] define \\(x\\hat\\phi\\) expected number transmissions given individual type \\(x\\), can therefore calculate probability individual remains susceptible. gives following relationship \\(\\phi\\) \\(\\hat\\phi\\): \\[ 1-\\phi(x) = S(x,0) e^{-x \\hat\\phi } \\\\ \\] hence can combine give: \\[ \\hat\\phi = \\int_0^\\infty (1-   S(x,0) e^{-x \\hat\\phi }) p(x) dx \\\\ \\hat\\phi = 1- \\int_0^\\infty  S(x,0) e^{-x \\hat\\phi } p(x) dx \\] assumption \\(S(x,0)\\) near 1 initially (.e. f), therefore obtain: \\[ \\hat\\phi = 1- \\int_0^\\infty p(x) e^{-x \\hat\\phi } dx \\]","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/theoretical_background.html","id":"final-size-equation-with-heterogeneous-mixing","dir":"Articles","previous_headings":"","what":"Final size equation with heterogeneous mixing","title":"Theoretical background","text":"can extend derivation homogenous model populations multiple age groups, following Andreasen (2011). age-dependent ODEs defined follows: \\[ \\frac{d S(,t)}{d t} = -S(,t) \\sum_b \\beta_{ab} (b,t) \\\\ \\frac{d (,t)}{d t}  =  S(,t) \\sum_b \\beta_{ab} (b,t) -\\gamma (,t) \\] \\(\\beta_{,b}\\) transmission rate group \\(b\\) group \\(\\). define \\(R_{,b} =\\beta_{,b}/\\gamma\\) group specific reproduction number, can rearrange integrate derive expression final size age group: \\[ - \\gamma \\sum_b R_{,b} (b,t)   = \\frac{d S(,t)}{d t} \\frac{1}{S(,t)} \\\\ - \\gamma \\sum_b R_{,b}  \\int_0^\\infty (b,t)  ~dt  = \\int_0^\\infty \\frac{d S(,t)}{d t} \\frac{1}{S(,t)} ~dt = \\mathrm{log}~S(,\\infty) -\\mathrm{log}~S(,0) = \\mathrm{log}~\\frac{S(,\\infty)}{S(,0)}  \\\\ -\\gamma \\int_0^\\infty (,t)  ~dt = \\int_0^\\infty \\frac{d S(,t)}{d t} +\\frac{dI(,t)}{dt} ~dt = S(,\\infty) -S(,0)  ~. \\] hence: \\[ \\mathrm{log}~\\frac{S(,\\infty)}{S(,0)}  = - \\sum_b R_{,b} [ S(b,\\infty) -S(b,0)] \\] define \\(\\underline\\phi = (\\phi_1, ... \\phi_n)\\) vector final sizes \\(n\\) age group, can rewrite \\[ \\mathrm{log}~\\underline\\phi  -\\mathbf{R} (1-\\underline\\phi) = 0 = F(\\underline\\phi) \\] \\(\\mathbf{R}\\) matrix entries \\(R_{,j}\\). , can use Newton’s method, time \\(\\underline\\phi\\) vector, hence need solve set linear equations step 2.","code":""},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Modelling uncertainty in R₀","text":"infection parameter (\\(R_0\\)) uncertain. want know much variation cause estimated final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Modelling uncertainty in R₀","text":"addition \\(R_0\\), demography data, social contact data, data distribution susceptibility among age groups; measure error estimated \\(R_0\\) infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Modelling uncertainty in R₀","text":"SIR epidemic, complete partitioning individuals different demographic infection risk groups.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"getting-r_0-contact-and-demography-data-and-susceptibility","dir":"Articles","previous_headings":"","what":"Getting \\(R_0\\), contact and demography data, and susceptibility","title":"Modelling uncertainty in R₀","text":"example uses social contact data POLYMOD project (Mossong et al. 2008) estimate final size epidemic U.K. data provided socialmixr package. data handled just “Get started” vignette. example also considers infection \\(R_0\\) 1.5. simplicity, example considers scenario susceptibility infection vary.","code":"# get UK polymod data from socialmixr polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population  # scale the contact matrix so the largest eigenvalue is 1.0 contact_matrix <- contact_matrix / max(Re(eigen(contact_matrix)$values))  # divide each row of the contact matrix by the corresponding demography contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector) # mean R0 is 1.5 r0_mean <- 1.5 # susceptibility is uniform susc_uniform <- matrix(   data = 1,   nrow = n_demo_grps,   ncol = 1L )  # p_susceptibility is uniform p_susc_uniform <- susc_uniform"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"running-final_size-over-r_0-samples","dir":"Articles","previous_headings":"","what":"Running final_size over \\(R_0\\) samples","title":"Modelling uncertainty in R₀","text":"basic reproduction number \\(R_0\\) infection might uncertain early stages epidemic. uncertainty can modelled running final_size() multiple times contact, demography, susceptibility data, sampling \\(R_0\\) values distribution. example assumes \\(R_0\\) estimate, uncertainty around estimate, provided mean standard deviation normal distribution. example considers normal distribution \\(N(\\mu = 1.5, \\sigma = 0.1)\\), \\(R_0\\) 1.5. can draw 1,000 \\(R_0\\) samples distribution run final_size() contact data demography data sample. quick, finalsize Rcpp package C++ backend.","code":"# create an R0 samples vector r0_samples <- rnorm(n = 1000, mean = r0_mean, sd = 0.1)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"iterate-final_size","dir":"Articles","previous_headings":"Running final_size over \\(R_0\\) samples","what":"Iterate final_size()","title":"Modelling uncertainty in R₀","text":"base R {tidyverse}","code":"# run final size on each sample with the same data final_size_data <- Map(   r0_samples, seq_along(r0_samples),   f = function(r0, i) {     # the i-th final size estimate     fs <- final_size(       r0 = r0,       contact_matrix = contact_matrix,       demography_vector = demography_vector,       susceptibility = susc_uniform,       p_susceptibility = p_susc_uniform     )      fs$replicate <- i     fs$r0_estimate <- r0     fs   } )  # combine data final_size_data <- Reduce(x = final_size_data, f = rbind)  # order age groups final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group )  # examine some replicates in the data head(final_size_data, 15) #>    demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1     [0,5) susc_grp_1              1    3453670  0.3232753  1116486.2 #> 2    [5,18) susc_grp_1              1    9761554  0.5820884  5682087.4 #> 3   [18,40) susc_grp_1              1   18110368  0.4287491  7764804.0 #> 4   [40,65) susc_grp_1              1   19288101  0.3622332  6986790.3 #> 5       65+ susc_grp_1              1    9673058  0.2286902  2212133.5 #> 6     [0,5) susc_grp_1              1    3453670  0.4313098  1489601.8 #> 7    [5,18) susc_grp_1              1    9761554  0.7045864  6877858.5 #> 8   [18,40) susc_grp_1              1   18110368  0.5551793 10054501.9 #> 9   [40,65) susc_grp_1              1   19288101  0.4804652  9267262.1 #> 10      65+ susc_grp_1              1    9673058  0.3171553  3067861.5 #> 11    [0,5) susc_grp_1              1    3453670  0.2433158   840332.6 #> 12   [5,18) susc_grp_1              1    9761554  0.4728007  4615269.1 #> 13  [18,40) susc_grp_1              1   18110368  0.3292155  5962213.9 #> 14  [40,65) susc_grp_1              1   19288101  0.2733295  5272007.0 #> 15      65+ susc_grp_1              1    9673058  0.1673297  1618589.9 #>    replicate r0_estimate #> 1          1    1.359996 #> 2          1    1.359996 #> 3          1    1.359996 #> 4          1    1.359996 #> 5          1    1.359996 #> 6          2    1.525532 #> 7          2    1.525532 #> 8          2    1.525532 #> 9          2    1.525532 #> 10         2    1.525532 #> 11         3    1.256274 #> 12         3    1.256274 #> 13         3    1.256274 #> 14         3    1.256274 #> 15         3    1.256274 library(tibble) library(dplyr) library(tidyr) library(purrr) library(forcats)  final_size_data <-   # create a dataframe with values from a vector   tibble(r0 = r0_samples) %>%   rownames_to_column() %>%   # map the function final_size() to all the r0 values   # with the same set of arguments   # with {purrr}   mutate(     temp = map(       .x = r0,       .f = final_size,       contact_matrix = contact_matrix,       demography_vector = demography_vector,       susceptibility = susc_uniform,       p_susceptibility = p_susc_uniform     )   ) %>%   # unnest all the dataframe outputs in temp   unnest(temp) %>%   # relevel the factor variable   mutate(     demo_grp = fct_relevel(       demo_grp,       contact_data %>%         pluck(\"demography\") %>%         pluck(\"age.group\")     )   )  head(final_size_data, 15) #> # A tibble: 15 × 8 #>    rowname    r0 demo_grp susc_grp   susceptibility group_size p_infected #>    <chr>   <dbl> <fct>    <chr>               <dbl>      <dbl>      <dbl> #>  1 1        1.36 [0,5)    susc_grp_1              1    3453670      0.323 #>  2 1        1.36 [5,18)   susc_grp_1              1    9761554      0.582 #>  3 1        1.36 [18,40)  susc_grp_1              1   18110368      0.429 #>  4 1        1.36 [40,65)  susc_grp_1              1   19288101      0.362 #>  5 1        1.36 65+      susc_grp_1              1    9673058      0.229 #>  6 2        1.53 [0,5)    susc_grp_1              1    3453670      0.431 #>  7 2        1.53 [5,18)   susc_grp_1              1    9761554      0.705 #>  8 2        1.53 [18,40)  susc_grp_1              1   18110368      0.555 #>  9 2        1.53 [40,65)  susc_grp_1              1   19288101      0.480 #> 10 2        1.53 65+      susc_grp_1              1    9673058      0.317 #> 11 3        1.26 [0,5)    susc_grp_1              1    3453670      0.243 #> 12 3        1.26 [5,18)   susc_grp_1              1    9761554      0.473 #> 13 3        1.26 [18,40)  susc_grp_1              1   18110368      0.329 #> 14 3        1.26 [40,65)  susc_grp_1              1   19288101      0.273 #> 15 3        1.26 65+      susc_grp_1              1    9673058      0.167 #> # ℹ 1 more variable: n_infected <dbl>"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/uncertainty_params.html","id":"visualise-uncertainty-in-final-size","dir":"Articles","previous_headings":"Running final_size over \\(R_0\\) samples","what":"Visualise uncertainty in final size","title":"Modelling uncertainty in R₀","text":"Figure 1: Estimated ranges final size hypothetical SIR epidemic age groups U.K. population, \\(R_0\\) estimated 1.5, standard deviation around estimate 0.1. example, relatively low uncertainty \\(R_0\\) estimates can also lead uncertainty estimated final size epidemic. Points represent means, ranges extend 5th 95th percentiles.","code":"ggplot(final_size_data) +   stat_summary(     aes(       demo_grp, p_infected     ),     fun = mean,     fun.min = function(x) {       quantile(x, 0.05)     },     fun.max = function(x) {       quantile(x, 0.95)     }   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0.25, 1)   ) +   theme_classic() +   theme(     legend.position = \"top\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     )   ) +   coord_cartesian(     expand = TRUE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Modelling heterogeneous social contacts","text":"substantial heterogeneity contact patterns population. want know heterogeneity affect final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Modelling heterogeneous social contacts","text":"estimate infection’s basic reproduction number \\(R_0\\); estimate distribution population different demographic groups (typically age groups); estimate contacts individuals different demographic groups; estimate susceptibility demographic group infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Modelling heterogeneous social contacts","text":"infection dynamics can captured using Susceptible-Infectious-Recovered (SIR) Susceptible-Exposed-Infectious-Recovered (SEIR) model, individuals infected acquire immunity subsequent infection, least remaining duration epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"defining-a-value-for-r_0","dir":"Articles","previous_headings":"","what":"Defining a value for \\(R_0\\)","title":"Modelling heterogeneous social contacts","text":"number statistical methods can used estimate \\(R_0\\) epidemic early stages available data. discussed , examples given episoap package. Instead, example considers infection \\(R_0\\) 1.5, similar potentially observed pandemic influenza.","code":"# define r0 as 1.5 r0 <- 1.5"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"heterogeneous-social-mixing","dir":"Articles","previous_headings":"Defining a value for \\(R_0\\)","what":"Heterogeneous social mixing","title":"Modelling heterogeneous social contacts","text":"social contact data used example illustrate important way populations may heterogeneous: various age groups can substantially different patterns social contacts, hence different probabilities acquiring transmitting infection epidemic. method implemented finalsize accounts heterogeneity. forms population heterogeneity covered “Heterogeneous susceptibility” vignette.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"getting-and-preparing-contact-and-demography-data","dir":"Articles","previous_headings":"","what":"Getting and preparing contact and demography data","title":"Modelling heterogeneous social contacts","text":"example uses social contact data POLYMOD project (Mossong et al. 2008) estimate final size epidemic U.K. data provided socialmixr package. contact data divided five age groups: 0 – 4, 5 – 17, 18 – 39, 40 – 64, 65 , specified using age.limits argument socialmixr::contact_matrix(). symmetric = TRUE argument socialmixr::contact_matrix() returns symmetric contact matrix, contacts reported group \\(\\{\\}\\) individuals group \\(\\{j\\}\\) reported group \\(\\{j\\}\\) group \\(\\{\\}\\). demographic data — number individuals age group — also available socialmixr::contact_matrix().","code":"# get UK polymod data polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # view the elements of the contact data list # the contact matrix contact_data$matrix #>          contact.age.group #> age.group     [0,5)   [5,18)  [18,40)  [40,65)       65+ #>   [0,5)   1.9157895 1.467205 3.278803 1.559611 0.3658614 #>   [5,18)  0.5191021 8.858736 3.421566 2.616146 0.6260247 #>   [18,40) 0.6252718 1.844236 5.440972 3.492124 0.8092367 #>   [40,65) 0.2792593 1.324010 3.278895 4.178218 1.2380907 #>   65+     0.1306272 0.631752 1.515092 2.468756 1.7142857  # the demography data contact_data$demography #>    age.group population proportion  year #>       <char>      <num>      <num> <int> #> 1:     [0,5)    3453670 0.05728738  2005 #> 2:    [5,18)    9761554 0.16191873  2005 #> 3:   [18,40)   18110368 0.30040378  2005 #> 4:   [40,65)   19288101 0.31993930  2005 #> 5:       65+    9673058 0.16045081  2005  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population demography_data <- contact_data$demography  # scale the contact matrix so the largest eigenvalue is 1.0 # this is to ensure that the overall epidemic dynamics correctly reflect # the assumed value of R0 contact_matrix <- contact_matrix / max(Re(eigen(contact_matrix)$values))  # divide each row of the contact matrix by the corresponding demography # this reflects the assumption that each individual in group {j} make contacts # at random with individuals in group {i} contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"population-susceptibility","dir":"Articles","previous_headings":"","what":"Population susceptibility","title":"Modelling heterogeneous social contacts","text":"starting scenario, consider novel pathogen age groups similar, high susceptibility infection. means assumed individuals fall single category: fully susceptible. Full uniform susceptibility can modelled matrix values 1.0, many rows demographic groups. matrix single column, representing single susceptibility group individuals belong. Final size calculations also need know proportion demographic group \\(\\{\\}\\) falls susceptibility group \\(\\{j\\}\\). distribution age groups susceptibility groups can represented demography-susceptibility distribution matrix. Since individuals age group susceptibility, variation within age groups. Consequently, individuals age group assumed fully susceptible. can represented single-column matrix, many rows age groups, many columns susceptibility groups. example, matrix p_susc_uniform 5 rows, one age group, one column, single high susceptibility group holds individuals.","code":"# all individuals are equally and highly susceptible n_susc_groups <- 1L susc_guess <- 1.0 susc_uniform <- matrix(   data = susc_guess,   nrow = n_demo_grps,   ncol = n_susc_groups ) p_susc_uniform <- matrix(   data = 1.0,   nrow = n_demo_grps,   ncol = n_susc_groups )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"why-susceptibility-and-p_susceptibility-are-matrices","dir":"Articles","previous_headings":"Population susceptibility","what":"Why susceptibility and p_susceptibility are matrices","title":"Modelling heterogeneous social contacts","text":"example models susceptibility (susc_uniform) demography--susceptibility (p_susc_uniform) matrices rather vectors. single susceptibility group special case general final size equation. finalsize supports multiple susceptibility groups (covered later), easily represented matrix, susceptibility matrix. element \\(\\{, j\\}\\) matrix represents susceptibility individuals demographic group \\(\\{\\}\\), susceptibility group \\(\\{j\\}\\). example, individuals equally susceptible infection, thus susceptibility matrix (susc_uniform) single column identical values. Consequently, demography-susceptibility distribution matrix (p_susc_uniform) dimensions, values 1.0. See “Heterogeneous susceptibility” example cases susceptibility varies within age groups.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"running-final_size","dir":"Articles","previous_headings":"","what":"Running final_size","title":"Modelling heterogeneous social contacts","text":"final size epidemic population can calculated using function package, final_size(). example allows function fall back default options arguments solver (\"iterative\") control (empty list).","code":"# calculate final size final_size_data <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_uniform,   p_susceptibility = p_susc_uniform )  # view the output data frame final_size_data #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1    [0,5) susc_grp_1              1    3453670  0.4160682    1436962 #> 2   [5,18) susc_grp_1              1    9761554  0.6888703    6724444 #> 3  [18,40) susc_grp_1              1   18110368  0.5379381    9742257 #> 4  [40,65) susc_grp_1              1   19288101  0.4639496    8948706 #> 5      65+ susc_grp_1              1    9673058  0.3042623    2943147"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"visualise-final-sizes","dir":"Articles","previous_headings":"Running final_size","what":"Visualise final sizes","title":"Modelling heterogeneous social contacts","text":"Figure 1: Final size SIR epidemic age group. final size cumulative number infections age group course epidemic, expressed proportion respective age group.","code":"# order demographic groups as factors final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = demography_data$age.group ) # plot data ggplot(final_size_data) +   geom_col(     aes(       demo_grp, p_infected     ),     colour = \"black\", fill = \"grey\"   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 1)   ) +   expand_limits(     x = c(0.5, nrow(final_size_data) + 0.5)   ) +   theme_classic() +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_contacts.html","id":"final-size-proportions-to-counts","dir":"Articles","previous_headings":"Running final_size","what":"Final size proportions to counts","title":"Modelling heterogeneous social contacts","text":"finalsize returns proportion age (susceptibility) group infected epidemic outbreak. final counts individuals infected can visualised well, multiplying final proportion age group infected total number individuals group. example show can done. Figure 2: Final size epidemic outbreak population, different values infection \\(R_0\\). Converting final size proportions age group counts shows individuals aged 18 – 64 make bulk cases scenario. may attributed largest age range analysis (years range ), people fall wide range others. Contrast figure one , similar proportions age group infected.","code":"# prepare demography data demography_data <- contact_data$demography  # merge final size counts with demography vector final_size_data <- merge(   final_size_data,   demography_data,   by.x = \"demo_grp\",   by.y = \"age.group\" )  # reset age group order final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group )  # multiply counts with proportion infected final_size_data$n_infected <- final_size_data$p_infected *   final_size_data$population ggplot(final_size_data) +   geom_col(     aes(       x = demo_grp, y = n_infected     ),     fill = \"grey\", col = \"black\"   ) +   expand_limits(     x = c(0.5, nrow(final_size_data) + 0.5)   ) +   scale_y_continuous(     labels = scales::comma_format(       scale = 1e-6, suffix = \"M\"     ),     limits = c(0, 15e6)   ) +   theme_classic() +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"Number infected (millions)\"   )"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"use-case","dir":"Articles","previous_headings":"","what":"Use case","title":"Modelling heterogeneous susceptibility","text":"substantial heterogeneity susceptibility infection population. want know heterogeneity affect final size epidemic.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"what-we-have","dir":"Articles","previous_headings":"","what":"What we have","title":"Modelling heterogeneous susceptibility","text":"addition infection \\(R_0\\), demography data, social contact data; Data within- -group variation susceptibility infection; Data proportion (probability) individuals demographic group specific susceptibility (risk) group.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"what-we-assume","dir":"Articles","previous_headings":"","what":"What we assume","title":"Modelling heterogeneous susceptibility","text":"addition SIR epidemic; partitioning individuals demographic risk groups complete, .e., individuals remain unaccounted .","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"primer-on-heterogeneous-susceptibility","dir":"Articles","previous_headings":"","what":"Primer on heterogeneous susceptibility","title":"Modelling heterogeneous susceptibility","text":"working definition susceptibility probability becoming infected contact infectious person. Age-specific factors influencing susceptibility individuals include, limited , direct (immunological) susceptibility infection upon exposure (e.g., due natural susceptibility previous infections, differences vaccination status), age-specific heterogeneous risk behaviour (Franco et al. 2022). example, SARS-CoV-2, children less susceptible adults. Decreased susceptibility result immune cross-protection coronaviruses (Huang et al. 2020), non-specific protection resulting recent infection respiratory viruses (Cowling et al. 2012), children experience frequently adults (Tsagarakis et al. 2018; Davies et al. 2020).","code":"# load finalsize library(finalsize)  library(socialmixr) library(ggplot2) library(colorspace)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"getting-r_0-and-contact-and-demography-data","dir":"Articles","previous_headings":"","what":"Getting \\(R_0\\) and contact and demography data","title":"Modelling heterogeneous susceptibility","text":"example uses social contact data POLYMOD project (Mossong et al. 2008) estimate final size epidemic U.K. data provided socialmixr package. data handled just “Get started” vignette, code displayed . example also considers disease \\(R_0\\) 1.5.","code":"# get UK polymod data polymod <- socialmixr::polymod contact_data <- socialmixr::contact_matrix(   polymod,   countries = \"United Kingdom\",   age.limits = c(0, 5, 18, 40, 65),   symmetric = TRUE )  # get the contact matrix and demography data contact_matrix <- t(contact_data$matrix) demography_vector <- contact_data$demography$population  # scale the contact matrix so the largest eigenvalue is 1.0 contact_matrix <- contact_matrix / max(Re(eigen(contact_matrix)$values))  # divide each row of the contact matrix by the corresponding demography contact_matrix <- contact_matrix / demography_vector  n_demo_grps <- length(demography_vector) r0 <- 1.5"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"susceptibility-variation-between-age-groups","dir":"Articles","previous_headings":"","what":"Susceptibility variation between age groups","title":"Modelling heterogeneous susceptibility","text":"example considers scenario susceptibility infection varies age groups, within groups. example, susceptibility infection increases age. can modelled susceptibility matrix higher values 40 – 64 65 age groups, relatively lower values groups. Note susceptibility matrix (susc_variable) still one column. next example show modelled matrix. corresponding demography-susceptibility group distribution matrix one-column matrix 1.0s: variation susceptibility within groups.","code":"# susceptibility is higher for the old susc_variable <- matrix(   data = c(0.75, 0.8, 0.85, 0.9, 1.0) ) n_susc_groups <- 1L p_susc_uniform <- matrix(   data = 1.0,   nrow = n_demo_grps,   ncol = n_susc_groups )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"calculate-the-effective-r_0","dir":"Articles","previous_headings":"","what":"Calculate the effective \\(R_0\\)","title":"Modelling heterogeneous susceptibility","text":"effective \\(R_0\\) epidemic can often different population heterogeneous social contacts heterogeneous susceptibility, within groups. effective \\(R_0\\) called \\(R_{\\text{eff}}\\) can calculated using function r_eff(). calculation shows user-specified \\(R_0\\) = 1.5 gives \\(R_{\\text{eff}}\\) \\(\\approx\\) 1.258 population, individuals fully susceptible infection.","code":"# calculate the effective R0 using `r_eff()` r_eff(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_variable,   p_susceptibility = p_susc_uniform ) #> [1] 1.25815"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"calculate-the-final-epidemic-size","dir":"Articles","previous_headings":"","what":"Calculate the final epidemic size","title":"Modelling heterogeneous susceptibility","text":"can compare final size population heterogeneous susceptibility population uniform, high susceptibility. Visualise effect modelling age-dependent susceptibility uniform susceptibility age groups. Figure 1: Final sizes epidemics populations wherein susceptibility infection either uniform (green), heterogeneous (purple), older individuals susceptible infection. Note , shown example, population heterogeneous susceptibility always expected lower final epidemic size overall otherwise identical population fully susceptible. illustrates broader point infections one age group independent infections age groups. due direct indirect social contacts age groups. Reducing susceptibility (thus infections) one age group can indirectly help reduce infections age groups well, overall level epidemic transmission reduced.","code":"# run final_size with default solvers and control options # final size with heterogeneous susceptibility final_size_heterog <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_variable,   p_susceptibility = p_susc_uniform ) # prepare uniform susceptibility matrix susc_uniform <- matrix(1.0, nrow = n_demo_grps, ncol = n_susc_groups)  # run final size with uniform susceptibility final_size_uniform <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_uniform,   p_susceptibility = p_susc_uniform ) # assign scenario name and join data final_size_heterog$scenario <- \"heterogeneous\" final_size_uniform$scenario <- \"uniform\"  # join dataframes final_size_data <- rbind(   final_size_heterog,   final_size_uniform )  # prepare age group order final_size_data$demo_grp <- factor(   final_size_data$demo_grp,   levels = contact_data$demography$age.group )  # examine the combined data final_size_data #>    demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1     [0,5) susc_grp_1           0.75    3453670  0.2288298   790302.8 #> 2    [5,18) susc_grp_1           0.80    9761554  0.4639058  4528441.7 #> 3   [18,40) susc_grp_1           0.85   18110368  0.3517122  6369637.7 #> 4   [40,65) susc_grp_1           0.90   19288101  0.3119224  6016391.5 #> 5       65+ susc_grp_1           1.00    9673058  0.2163372  2092642.5 #> 6     [0,5) susc_grp_1           1.00    3453670  0.4160682  1436962.2 #> 7    [5,18) susc_grp_1           1.00    9761554  0.6888703  6724444.3 #> 8   [18,40) susc_grp_1           1.00   18110368  0.5379381  9742257.1 #> 9   [40,65) susc_grp_1           1.00   19288101  0.4639496  8948705.9 #> 10      65+ susc_grp_1           1.00    9673058  0.3042623  2943147.1 #>         scenario #> 1  heterogeneous #> 2  heterogeneous #> 3  heterogeneous #> 4  heterogeneous #> 5  heterogeneous #> 6        uniform #> 7        uniform #> 8        uniform #> 9        uniform #> 10       uniform ggplot(final_size_data) +   geom_col(     aes(       x = demo_grp, y = p_infected,       fill = scenario     ),     col = \"black\",     position = position_dodge(       width = 0.75     )   ) +   expand_limits(     x = c(0.5, length(unique(final_size_data$demo_grp)) + 0.5)   ) +   scale_fill_discrete_qualitative(     palette = \"Cold\",     name = \"Population susceptibility\",     labels = c(\"Heterogeneous\", \"Uniform\")   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 1)   ) +   theme_classic() +   theme(     legend.position = \"top\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     )   ) +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"susceptibility-variation-within-and-between-age-groups","dir":"Articles","previous_headings":"","what":"Susceptibility variation within and between age groups","title":"Modelling heterogeneous susceptibility","text":"example considers scenario susceptibility infection varies within age groups. Immunisation infection intervention campaign common cause within-age group variation susceptibility, example can thought examining effect vaccination. effect immunisation susceptibility can modelled reduction initial susceptibility age group. done adding column susceptibility matrix, lower values first column. example considers modest 25% reduction susceptibility due vaccination. Note two susceptibility groups, susceptibility matrix two columns. corresponding demography-susceptibility distribution matrix must also two columns! also need model proportion age group immunised, therefore lower susceptibility infection. , can modify demography-susceptibility distribution matrix. example model considers half age group immunised non-immunised groups. general terms, interpreted rate vaccine uptake, effect existing immunity previous infection similar pathogen. Recall row demography-susceptibility distribution matrix must always sum 1.0! effect immunisation (reduction susceptibility) can visualised comparing proportion immunised un-immunised groups infected. Compare scenarios susceptibility heterogeneous groups, immunisation scenario susceptibility also varies within groups. Figure 2: Final size SIR epidemic \\(R_0\\) = 1.5, population wherein 50% age group immunised infection. immunisation assumed reduce initial susceptibility age group 25%. leads within- -group heterogeneity susceptibility. Vaccinating even 50% age group can substantially reduce epidemic final size comparison scenario immunisation (grey). Note final sizes figure 50%.","code":"# immunisation effect immunisation_effect <- 0.25 # model an immunised group with a 25% lower susceptibility susc_immunised <- cbind(   susc_variable,   susc_variable * (1 - immunisation_effect) )  # assign names to groups colnames(susc_immunised) <- c(\"Un-immunised\", \"Immunised\") n_risk_groups <- ncol(susc_immunised) # immunisation rate is uniform across age groups immunisation_rate <- rep(0.5, n_demo_grps)  # add a second column to p_susceptibility p_susc_immunised <- cbind(   susceptible = p_susc_uniform - immunisation_rate,   immunised = immunisation_rate ) # we run final size over all r0 values final_size_immunised <- final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susc_immunised,   p_susceptibility = p_susc_immunised ) # add scenario identifier final_size_immunised$scenario <- \"immunisation\"  # prepare age group order final_size_heterog$demo_grp <- factor(   final_size_heterog$demo_grp,   levels = contact_data$demography$age.group )  final_size_immunised$demo_grp <- factor(   final_size_immunised$demo_grp,   levels = contact_data$demography$age.group )  # examine the data final_size_immunised #>    demo_grp     susc_grp susceptibility group_size p_infected n_infected #> 1     [0,5) Un-immunised         0.7500    1726835 0.10882106   187916.0 #> 2    [5,18) Un-immunised         0.8000    4880777 0.25096327  1224895.8 #> 3   [18,40) Un-immunised         0.8500    9055184 0.17473366  1582245.4 #> 4   [40,65) Un-immunised         0.9000    9644050 0.15172135  1463208.4 #> 5       65+ Un-immunised         1.0000    4836529 0.10075783   487318.1 #> 6     [0,5)    Immunised         0.5625    1726835 0.08277964   142946.8 #> 7    [5,18)    Immunised         0.6000    4880777 0.19484900   951014.5 #> 8   [18,40)    Immunised         0.6375    9055184 0.13414414  1214699.9 #> 9   [40,65)    Immunised         0.6750    9644050 0.11609844  1119659.2 #> 10      65+    Immunised         0.7500    4836529 0.07656251   370296.8 #>        scenario #> 1  immunisation #> 2  immunisation #> 3  immunisation #> 4  immunisation #> 5  immunisation #> 6  immunisation #> 7  immunisation #> 8  immunisation #> 9  immunisation #> 10 immunisation ggplot(final_size_immunised) +   geom_col(     data = final_size_heterog,     aes(       x = demo_grp, y = p_infected,       fill = \"baseline\",       colour = \"baseline\"     ),     width = 0.75,     show.legend = TRUE   ) +   geom_col(     aes(       x = demo_grp, y = p_infected,       fill = susc_grp     ),     col = \"black\",     position = position_dodge()   ) +   facet_grid(     cols = vars(scenario),     labeller = labeller(       scenario = c(         heterogeneous = \"Between groups only\",         immunisation = \"Within & between groups\"       )     )   ) +   expand_limits(     x = c(0.5, length(unique(final_size_immunised$demo_grp)) + 0.5)   ) +   scale_fill_discrete_qualitative(     palette = \"Dynamic\",     rev = TRUE,     limits = c(\"Immunised\", \"Un-immunised\"),     name = \"Immunisation scenario\",     na.value = \"lightgrey\"   ) +   scale_colour_manual(     values = \"black\",     name = \"No immunisation\",     labels = \"Susceptibility homogeneous\\nwithin groups\"   ) +   scale_y_continuous(     labels = scales::percent,     limits = c(0, 0.5)   ) +   theme_classic() +   theme(     legend.position = \"bottom\",     legend.key.height = unit(2, \"mm\"),     legend.title = ggtext::element_markdown(       vjust = 1     ),     strip.background = element_blank(),     strip.text = element_text(       face = \"bold\",       size = 11     )   ) +   guides(     colour = guide_legend(       override.aes = list(fill = \"lightgrey\"),       title.position = \"top\",       order = 1     ),     fill = guide_legend(       nrow = 2,       title.position = \"top\",       order = 2     )   ) +   coord_cartesian(     expand = FALSE   ) +   labs(     x = \"Age group\",     y = \"% Infected\",     title = \"Heterogeneous susceptibility\",     fill = \"Immunisation\\nscenario\"   )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"getting-data-on-within-group-susceptibility-differences","dir":"Articles","previous_headings":"Susceptibility variation within and between age groups","what":"Getting data on within-group susceptibility differences","title":"Modelling heterogeneous susceptibility","text":"within-group differences susceptibility, due immunisation, users obtain information age-specific vaccination uptake statistics national governments (, UK). antibody response decays known immunisation course (Iyer et al. 2020), detailed statistics percentage people vaccinated preceding months (, UK), may informative.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/articles/varying_susceptibility.html","id":"heterogeneous-susceptibility-without-social-contact-heterogeneity","dir":"Articles","previous_headings":"","what":"Heterogeneous susceptibility without social contact heterogeneity","title":"Modelling heterogeneous susceptibility","text":"finalsize can also account heterogeneous susceptibilities without include heterogeneity social contact patterns. may useful calculating final epidemic size without good estimate social contact patterns available. done similar way “Get started” vignette, susceptibility p_susceptibility passed \\(N\\)-column matrices, referring susceptibilities \\(N\\) susceptibility groups, proportions population groups, respectively. example considers pandemic influenza \\(R_0\\) 1.5, affecting U.K population 67 million assumed mix uniformly, two distinct susceptibility groups, susceptibility values 1.0 (70% population), 0.7 (30% population).","code":"# define r0 r0 <- 1.5  # define UK population size and prepare contact matrix uk_pop <- 67 * 1e6 contact_matrix <- matrix(1.0) / uk_pop  # define susceptibility matrix susceptibility <- matrix(c(1.0, 0.7), nrow = 1, ncol = 2)  # define p_susceptibility p_susceptibility <- matrix(c(0.7, 0.3), nrow = 1, ncol = 2)  # running final_size() final_size(   r0 = r0,   demography_vector = uk_pop,   contact_matrix = contact_matrix,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #>     demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1 demo_grp_1 susc_grp_1            1.0   46900000  0.5083807   23843053 #> 2 demo_grp_1 susc_grp_2            0.7   20100000  0.3916685    7872538"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Pratik Gupte. Author, copyright holder. Edwin Van Leeuwen. Author, copyright holder. Adam Kucharski. Author, copyright holder. Rosalind Eggo. Contributor, maintainer. Hugo Gruson. Contributor. Thibaut Jombart. Contributor. Andree Valle-Campos. Contributor. Joshua W. Lambert. Reviewer.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Gupte P, Van Leeuwen E, Kucharski (2025). finalsize: Calculate Final Size Epidemic. R package version 0.2.1.9000, https://epiverse-trace.github.io/finalsize/, https://github.com/epiverse-trace/finalsize.","code":"@Manual{,   title = {finalsize: Calculate the Final Size of an Epidemic},   author = {Pratik Gupte and Edwin {Van Leeuwen} and Adam Kucharski},   year = {2025},   note = {R package version 0.2.1.9000,     https://epiverse-trace.github.io/finalsize/},   url = {https://github.com/epiverse-trace/finalsize}, }"},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"finalsize-calculate-the-final-size-of-an-epidemic-","dir":"","previous_headings":"","what":"Calculate the Final Size of an Epidemic","title":"Calculate the Final Size of an Epidemic","text":"finalsize R package calculate final size SIR epidemic populations heterogeneity social contacts infection susceptibility. finalsize provides estimates total proportion population infected course epidemic, can account demographic distribution (age groups) demography-specific contact patterns, well heterogeneous susceptibility infection groups (due age-group specific immune responses) within groups (due immunisation programs). advantage approach requires fewer parameters defined compared model simulates full transmission dynamics time, models epidemics package. finalsize implements methods outlined Andreasen (2011), Miller (2012), Kucharski et al. (2014), Bidari et al. (2016). finalsize can help provide rough estimates effectiveness pharmaceutical interventions form immunisation programmes, effect naturally acquired immunity previous infection (see vignette). finalsize relies Eigen via RcppEigen fast matrix algebra, developed Centre Mathematical Modelling Infectious Diseases London School Hygiene Tropical Medicine part Epiverse-TRACE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Calculate the Final Size of an Epidemic","text":"package can installed CRAN using","code":"install.packages(\"finalsize\")"},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"development-version","dir":"","previous_headings":"Installation","what":"Development version","title":"Calculate the Final Size of an Epidemic","text":"current development version finalsize can installed Github using remotes package. development version documentation can found .","code":"if(!require(\"pak\")) install.packages(\"pak\") pak::pak(\"epiverse-trace/finalsize\")"},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick start","title":"Calculate the Final Size of an Epidemic","text":"main function finalsize final_size(), calculates final size epidemic given R0R_0. Optionally, final_size() can estimate epidemic size populations differences among demographic groups social contact patterns, susceptibility infection. can use social contact data (, socialmixr package) estimate final size epidemic disease R0 1.5, given three age groups interest — 0-19, 20-39 40+. -20 age group assumed fully susceptible disease, whereas individuals aged 20 half susceptible 20. Helper functions included finalsize provided calculate effective R0R_0, called ReffR_{eff}, demographic susceptibility distribution data, helpers can convert R0R_0 transmission rate λ\\lambda.","code":"# load finalsize library(finalsize)  final_size(1.5) #>     demo_grp   susc_grp susceptibility p_infected #> 1 demo_grp_1 susc_grp_1              1  0.5828132 # Load example POLYMOD social contacts data included with the package data(polymod_uk)  # Define contact matrix (entry {ij} is contacts in group i reported by group j) contact_matrix <- polymod_uk$contact_matrix  # Define population in each age group demography_vector <- polymod_uk$demography_vector  # Define susceptibility of each group susceptibility <- matrix(   data = c(1.0, 0.5, 0.5),   nrow = length(demography_vector),   ncol = 1 )  # Assume uniform susceptibility within age groups p_susceptibility <- matrix(   data = 1.0,   nrow = length(demography_vector),   ncol = 1 )  # R0 of the disease r0 <- 1.5 # assumed for pandemic influenza  # Calculate the proportion of individuals infected in each age group final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #>   demo_grp   susc_grp susceptibility p_infected #> 1   [0,20) susc_grp_1            1.0 0.32849966 #> 2  [20,40) susc_grp_1            0.5 0.10532481 #> 3      40+ susc_grp_1            0.5 0.06995193 # calculate the effective R0 using `r_eff()` r_eff(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #> [1] 1.171758"},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"package-vignettes","dir":"","previous_headings":"","what":"Package vignettes","title":"Calculate the Final Size of an Epidemic","text":"details use finalsize can found online documentation package vignettes, “Articles”.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"help","dir":"","previous_headings":"","what":"Help","title":"Calculate the Final Size of an Epidemic","text":"report bug please open issue.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"contribute","dir":"","previous_headings":"","what":"Contribute","title":"Calculate the Final Size of an Epidemic","text":"Contributions finalsize welcomed. Please follow package contributing guide.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"code-of-conduct","dir":"","previous_headings":"","what":"Code of conduct","title":"Calculate the Final Size of an Epidemic","text":"Please note finalsize project released Contributor Code Conduct. contributing project, agree abide terms.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/index.html","id":"citing-this-package","dir":"","previous_headings":"","what":"Citing this package","title":"Calculate the Final Size of an Epidemic","text":"","code":"citation(\"finalsize\") #> To cite package 'finalsize' in publications use: #>  #>   Gupte P, Van Leeuwen E, Kucharski A (2024). _finalsize: Calculate the #>   Final Size of an Epidemic_. R package version 0.2.1.9000, #>   https://epiverse-trace.github.io/finalsize/, #>   <https://github.com/epiverse-trace/finalsize>. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {finalsize: Calculate the Final Size of an Epidemic}, #>     author = {Pratik Gupte and Edwin {Van Leeuwen} and Adam Kucharski}, #>     year = {2024}, #>     note = {R package version 0.2.1.9000,  #> https://epiverse-trace.github.io/finalsize/}, #>     url = {https://github.com/epiverse-trace/finalsize}, #>   }"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/dot-final_size.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate the final size of an epidemic — .final_size","title":"Calculate the final size of an epidemic — .final_size","text":"internal function interfaces R function final_size() functions package header.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/dot-final_size.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate the final size of an epidemic — .final_size","text":"","code":".final_size(parameters)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/dot-final_size.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate the final size of an epidemic — .final_size","text":"parameters named list parameters final size calculation. See R function documentation details input checking.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":null,"dir":"Reference","previous_headings":"","what":"Final size of an epidemic — final_size","title":"Final size of an epidemic — final_size","text":"final_size calculates final size epidemic outbreak given \\(R_0\\), options specifying population heterogeneous mixing, heterogeneous susceptibility infection conferred immunisation programme.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Final size of an epidemic — final_size","text":"","code":"final_size(   r0,   contact_matrix = matrix(1),   demography_vector = 1,   susceptibility = matrix(1),   p_susceptibility = matrix(1),   solver = c(\"iterative\", \"newton\"),   control = list() )"},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Final size of an epidemic — final_size","text":"r0 basic reproductive number \\(R_0\\) disease. contact_matrix Social contact matrix. Entry \\(m_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\) . Defaults singleton matrix \\([1]\\), representing homogeneously mixing population. demography_vector Demography vector. Entry \\(v_{}\\) gives proportion total population group \\(\\) (model normalise needed). Defaults 1, representing population demographic structure important (known), individuals assumed belong demographic group. susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(k\\). Defaults singleton matrix \\([1]\\), representing population individuals fully susceptible infection. p_susceptibility matrix giving probability individual demography group \\(\\) risk (susceptibility) group \\(k\\). row represents overall distribution individuals demographic group \\(\\) across risk groups, row must sum 1.0. Defaults singleton matrix \\([1]\\), representing population individuals fully susceptible. solver solver use. Options \"iterative\" (default) \"newton\", iterative solver, Newton solver, respectively. Special conditions apply using Newton solver, see control argument. control list named solver options, see Solver options.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Final size of an epidemic — final_size","text":"data.frame proportion number infected individuals, within demography group susceptibility group combination. sizes demography-susceptibility combination also returned column. demography groups susceptibility groups named, names added relevant columns. groups named, synthetic names added form demo_grp_<>, demographic group \\(\\).","code":""},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"specifying-heterogeneous-mixing-and-susceptibility","dir":"Reference","previous_headings":"","what":"Specifying heterogeneous mixing and susceptibility","title":"Final size of an epidemic — final_size","text":"final_size() allows heterogeneous population mixing susceptibility, described dedicated vignettes: Heterogeneous population mixing: See vignette \"Modelling heterogeneous social contacts\" (vignette(\"varying_contacts\", package = \"finalsize\")); Heterogeneous susceptibility infection: See vignette \"Modelling heterogeneous susceptibility\" (vignette(\"varying_susceptibility\", package = \"finalsize\")).","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"solver-options","dir":"Reference","previous_headings":"","what":"Solver options","title":"Final size of an epidemic — final_size","text":"control argument accepts list solver options, iterative solver taking two extra arguments Newton solver. optional argument, default options used within solver functions argument missing. Arguments provided override solver defaults.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"common-options","dir":"Reference","previous_headings":"","what":"Common options","title":"Final size of an epidemic — final_size","text":"iterations: number iterations solve final size, unless error solver tolerance. Default = 10000. tolerance: solver tolerance; solving final size ends error drops tolerance. Defaults set 1e-6. Larger tolerance values likely lead inaccurate final size estimates.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"iterative-solver-options","dir":"Reference","previous_headings":"","what":"Iterative solver options","title":"Final size of an epidemic — final_size","text":"step_rate: solver step rate. Defaults 1.9 value found work well. adapt_step: Boolean, whether solver step rate changed based solver error. Defaults TRUE.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/final_size.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Final size of an epidemic — final_size","text":"","code":"## For a given R_0 r0 <- 2.0 final_size(r0) #>     demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1 demo_grp_1 susc_grp_1              1          1  0.7968124  0.7968124  ## For a population with multiple demographic groups # load example POLYMOD data included in the package data(polymod_uk) contact_matrix <- polymod_uk$contact_matrix demography_vector <- polymod_uk$demography_vector  # define the number of age and susceptibility groups n_demo_grps <- length(demography_vector) n_risk_grps <- 3  # In this example, all risk groups from all age groups are fully # susceptible, and the final size in each group is influenced only by # differences in social contacts susceptibility <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps )  p_susceptibility <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps ) # p_susceptibility rows must sum to 1.0 p_susceptibility <- p_susceptibility / rowSums(p_susceptibility)  # using default arguments for `solver` and `control` final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1              1    4933097  0.8532885    4209355 #> 2  [20,40) susc_grp_1              1    5508767  0.7974557    4392998 #> 3      40+ susc_grp_1              1    9653720  0.6880834    6642564 #> 4   [0,20) susc_grp_2              1    4933097  0.8532885    4209355 #> 5  [20,40) susc_grp_2              1    5508767  0.7974557    4392998 #> 6      40+ susc_grp_2              1    9653720  0.6880834    6642564 #> 7   [0,20) susc_grp_3              1    4933097  0.8532885    4209355 #> 8  [20,40) susc_grp_3              1    5508767  0.7974557    4392998 #> 9      40+ susc_grp_3              1    9653720  0.6880834    6642564  ## Using manually specified solver settings for the iterative solver control <- list(   iterations = 100,   tolerance = 1e-3,   step_rate = 1.9,   adapt_step = TRUE )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility,   solver = \"iterative\",   control = control ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1              1    4933097  0.8532715    4209271 #> 2  [20,40) susc_grp_1              1    5508767  0.7974597    4393020 #> 3      40+ susc_grp_1              1    9653720  0.6880988    6642713 #> 4   [0,20) susc_grp_2              1    4933097  0.8532715    4209271 #> 5  [20,40) susc_grp_2              1    5508767  0.7974597    4393020 #> 6      40+ susc_grp_2              1    9653720  0.6880988    6642713 #> 7   [0,20) susc_grp_3              1    4933097  0.8532715    4209271 #> 8  [20,40) susc_grp_3              1    5508767  0.7974597    4393020 #> 9      40+ susc_grp_3              1    9653720  0.6880988    6642713  ## Using manually specified solver settings for the newton solver control <- list(   iterations = 100,   tolerance = 1e-3 )  final_size(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility,   solver = \"newton\",   control = control ) #>   demo_grp   susc_grp susceptibility group_size p_infected n_infected #> 1   [0,20) susc_grp_1              1    4933097  0.9999876    4933035 #> 2  [20,40) susc_grp_1              1    5508767  0.9999873    5508697 #> 3      40+ susc_grp_1              1    9653720  0.9999867    9653592 #> 4   [0,20) susc_grp_2              1    4933097  0.9999876    4933035 #> 5  [20,40) susc_grp_2              1    5508767  0.9999873    5508697 #> 6      40+ susc_grp_2              1    9653720  0.9999867    9653592 #> 7   [0,20) susc_grp_3              1    4933097  0.9999876    4933035 #> 8  [20,40) susc_grp_3              1    5508767  0.9999873    5508697 #> 9      40+ susc_grp_3              1    9653720  0.9999867    9653592"},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/finalsize-package.html","id":null,"dir":"Reference","previous_headings":"","what":"finalsize: Calculate the Final Size of an Epidemic — finalsize-package","title":"finalsize: Calculate the Final Size of an Epidemic — finalsize-package","text":"Calculate final size susceptible-infectious-recovered epidemic population demographic variation contact patterns susceptibility disease, discussed Miller (2012) doi:10.1007/s11538-012-9749-6 .","code":""},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/finalsize-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"finalsize: Calculate the Final Size of an Epidemic — finalsize-package","text":"Maintainer: Rosalind Eggo r.eggo@lshtm.ac.uk (ORCID) [contributor] Authors: Pratik Gupte pratik.gupte@lshtm.ac.uk (ORCID) [copyright holder] Edwin Van Leeuwen edwin.vanleeuwen@ukhsa.gov.uk (ORCID) [copyright holder] Adam Kucharski adam.kucharski@lshtm.ac.uk (ORCID) [copyright holder] contributors: Hugo Gruson hugo.gruson@data.org (ORCID) [contributor] Thibaut Jombart thibaut@data.org (ORCID) [contributor] Andree Valle-Campos andree.valle-campos@lshtm.ac.uk (ORCID) [contributor] Joshua W. Lambert joshua.lambert@lshtm.ac.uk (ORCID) [reviewer]","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/polymod_uk.html","id":null,"dir":"Reference","previous_headings":"","what":"Example POLYMOD social contact data for the U.K. — polymod_uk","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"example social contact demography data use finalsize, accessed POLYMOD social contacts dataset using socialmixr package. Data United Kingdom, age limits set 0, 20, 40 years, symmetric = TRUE. Code get data given data-raw/polymod_uk.R.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/polymod_uk.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"","code":"polymod_uk"},{"path":[]},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/polymod_uk.html","id":"polymod-uk","dir":"Reference","previous_headings":"","what":"polymod_uk","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"list two named elements: contact_matrix contact matrix mean contacts age groups. matrix scaled largest real eigenvalue,  row scaled corresponding element demography_vector. demography_vector vector number individuals three age groups: 0 – 20, 20 – 40, 40+.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/polymod_uk.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Example POLYMOD social contact data for the U.K. — polymod_uk","text":"doi:10.1371/journal.pmed.0050074 ; obtained using socialmixr::polymod. See methods data-raw/polymod_uk.R.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":null,"dir":"Reference","previous_headings":"","what":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"Converts \\(R_0\\) transmission rate \\(\\lambda\\), calculates effective reproduction number \\(R_\\text{eff}\\) population, accounting population characteristics including demographic heterogeneity social contacts, heterogeneity demographic distribution, heterogeneity susceptibility infection. Uses R0 (\\(R_0\\)), contact matrix (\\(C\\)), population (\\(N\\)), infectious period (\\(\\gamma\\)) calculate transmission rate using following equation. $$\\lambda = R_0 / ({Max}(EV(C)) \\gamma)$$ \\(EV(C)\\) denotes eigenvalues matrix \\(C\\) calculated social contacts matrix scaled number individuals demographic susceptibility group population.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"","code":"lambda_to_r0(   lambda,   contact_matrix,   demography_vector,   susceptibility,   p_susceptibility,   infectious_period = 1.8 )  r0_to_lambda(   r0,   contact_matrix,   demography_vector,   susceptibility,   p_susceptibility,   infectious_period = 1.8 )  r_eff(r0, contact_matrix, demography_vector, susceptibility, p_susceptibility)"},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"lambda transmission rate disease, also called 'force infection' (\\(\\lambda\\)). different effective transmission rate (\\(\\beta\\)). contact_matrix Social contact matrix. Entry \\(m_{ij}\\) gives average number contacts group \\(\\) reported participants group \\(j\\) demography_vector Demography vector. Entry \\(v_{}\\) gives proportion total population group \\(\\). susceptibility matrix giving susceptibility individuals demographic group \\(\\) risk group \\(k\\). p_susceptibility matrix giving probability individual demography group \\(\\) risk (susceptibility) group \\(k\\). row represents overall distribution individuals demographic group \\(\\) across risk groups, row must sum 1.0. infectious_period Duration infectious period days. Default value 1.8 days. r0 basic reproductive number \\(R_0\\) infection.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"Returns single number calculated value.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"Given transmission rate (\\(\\lambda\\)), social contacts matrix (\\(c\\)), demography (\\(N\\)), distribution \\(P\\) demographic group \\(\\) susceptibility groups \\(S\\), infectious period (\\(\\gamma\\)) r_eff() calculates effective reproductive number; lamda_to_r0() calculates \\(R_0\\) transmission rate $$R_0 = {Max}(EV(C)) \\times \\lambda \\gamma$$ r0_to_lambda() calculates transmission rate $$\\lambda = R_0 / ({Max}(EV(C)) \\gamma)$$ Note also called 'force infection' different effective transmission rate often denoted \\(\\beta\\). , \\(EV(C)\\) denotes eigenvalues matrix \\(C\\) calculated social contacts matrix scaled number individuals demographic susceptibility group population.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/reference/r0_conversions.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Converts between epidemiological parameters related to \\(R_0\\) — r0_conversions","text":"","code":"#### Prepare data #### # Get example dataset and prepare contact matrix and demography data(polymod_uk) contact_matrix <- polymod_uk$contact_matrix demography_vector <- polymod_uk$demography_vector  # define lambda lambda <- 0.3  # define infectious period of 5 days infectious_period <- 5 # define the number of age and susceptibility groups n_demo_grps <- length(demography_vector) n_risk_grps <- 3  # In this example, risk varies across groups susceptibility <- matrix(   data = c(0.5, 0.7, 1.0), nrow = n_demo_grps, ncol = n_risk_grps )  # risk does not vary within groups p_susceptibility <- matrix(   data = 1, nrow = n_demo_grps, ncol = n_risk_grps ) # p_susceptibility rows must sum to 1.0 p_susceptibility <- p_susceptibility / rowSums(p_susceptibility)  #### Effective R #### r0 <- 2.0 r_eff(   r0 = r0,   contact_matrix = contact_matrix,   demography_vector = demography_vector,   susceptibility = susceptibility,   p_susceptibility = p_susceptibility ) #> [1] 1.424081  #### Transmission rate to R0 #### lambda_to_r0(   lambda, contact_matrix, demography_vector,   susceptibility, p_susceptibility,   infectious_period ) #> [1] 1.068061  #### R0 to Transmission rate #### r0 <- 1.5 r0_to_lambda(   r0, contact_matrix, demography_vector,   susceptibility, p_susceptibility,   infectious_period ) #> [1] 0.1817514"},{"path":"https://epiverse-trace.github.io/finalsize/dev/news/index.html","id":"finalsize-development-version","dir":"Changelog","previous_headings":"","what":"finalsize (development version)","title":"finalsize (development version)","text":"Maintainer changing @rozeggo (#212). Updated GitHub Actions workflows line {epiverse-trace/packagetemplate} (#212). Updated DESCRIPTION license files new maintainer new copyright year (#212). Added R/dev-utils.R extra release issue bullet points, added tools/check.env global environment checks (#212). Corrected internal article links vignettes (#212). Added continuous benchmarking workflows using {touchstone} following pattern {epiforecasts/EpiNow2} (#212). Updated final_size() return demography-susceptibility group sizes absolute value individuals infected columns.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/news/index.html","id":"finalsize-021","dir":"Changelog","previous_headings":"","what":"finalsize 0.2.1","title":"finalsize 0.2.1","text":"CRAN release: 2024-04-09 patch adds: Default values contact matrix, susceptibility matrix, susceptibility distribution matrix allow quick estimates final size given R0R_0 population homogeneous mixing full susceptibility (#180); Combines documentation functions r_eff(), r0_to_lambda(), lambda_to_r0() name ‘r0_conversions’; Adds vignettes theoretical background projecting re-emergence disease due demographic turnover (#193, #194 @adamkucharski); Streamlines examples Readme; Replaces PNG logo Readme SVG version; Updates GitHub Actions workflow YAMLs, .lintr config file, _pkgdown.yml, .Rbuildignore, CITATION.cff CRAN-SUBMISSION; workflows configuration files bring package line {packagetemplate} (#181, #186, #188). Standardises DESCRIPTION file. Adds package-level documentation. Adds spellchecking WORDLIST file. Adds tools check package modify global state, code flag partial matching function arguments,. Updates references cited vignettes.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/news/index.html","id":"finalsize-020","dir":"Changelog","previous_headings":"","what":"finalsize 0.2.0","title":"finalsize 0.2.0","text":"CRAN release: 2023-05-09 second release finalsize, includes: package’s C++ code solver algorithms moved source files src/ headers inst/include/ package includes package header inst/include called finalsize.h, allows Rcpp packages link finalsize reuse solver algorithms provided . Calculate effective basic reproductive number ReffR_{eff} population heterogeneous social contacts susceptibility infection Convert basic reproductive number provided user R0R_0 transmission rate (denoted λ\\lambda), given population’s social contacts susceptibility structure Convert user-provided transmission rate basic reproductive number given population’s social contacts susceptibility structure guide constructing susceptibility matrices comparison simple susceptible-infectious-recovered epidemic model package now specifies C++17 standard Readme.Rmd uses auto-rendering package repository name Readme.md via updated render-readme Github Actions workflow Cpplint workflow now includes linting checking using Cppcheck header files Updated NEWS.md file track changes package.","code":""},{"path":"https://epiverse-trace.github.io/finalsize/dev/news/index.html","id":"finalsize-01","dir":"Changelog","previous_headings":"","what":"finalsize 0.1","title":"finalsize 0.1","text":"CRAN release: 2022-12-05 Initial release finalsize, R package calculate final size epidemic population demographic variation social contacts susceptibility infection. release includes: choice equation solver functions. 100% code coverage, basic usage vignette, two advanced vignettes, Example data POLYMOD dataset obtained using socialmixr R package, Workflows render vignettes README website.","code":""}]
